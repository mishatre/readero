{"version":3,"sources":["Components/ReaderControls/styles.module.scss","Components/Book/styles.module.scss","Pages/Library/styles.module.scss","Components/VirtualBookPlayer/styles.module.scss","Components/BookPlayer/styles.module.scss","Pages/Reader/ReaderHeader/styles.module.scss","Pages/Reader/styles.module.scss","utils/context.ts","Providers/Settings/index.tsx","Libraries/SentenceTokenizer.ts","Libraries/epubToTxt.ts","Providers/Library/index.tsx","Providers/ReadingStats/index.tsx","Providers/index.tsx","hooks/useTextMeasurer.ts","Components/VirtualBookPlayer/index.tsx","Components/SingleWordRender/index.tsx","Components/BookPlayer/index.tsx","assets/icons/minus-solid.svg","assets/icons/plus-solid.svg","utils/wordTime.ts","Components/ReaderControls/index.tsx","assets/icons/cog-solid.svg","assets/icons/angle-left-solid.svg","Pages/Reader/ReaderHeader/index.tsx","Pages/Reader/index.tsx","Components/Book/index.tsx","hooks/useFileInput.ts","Pages/Library/index.tsx","App.tsx","reportWebVitals.ts","index.tsx"],"names":["module","exports","createCtx","ctx","createContext","undefined","c","useContext","Error","Provider","defaultSettings","font","fontSize","wordsPerMinute","useORP","slowDownOnLongWords","useSettingsContext","SettingsProvider","children","useState","settings","setSettings","useEffect","defaultWordsPerMinute","defaultSettingsRest","settingsString","localStorage","getItem","Object","assign","JSON","parse","setItem","stringify","wordsPerMinuteString","Number","String","setSetting","useCallback","key","value","currentSettings","setWordsPerMinute","newValue","updateWordsPerMinute","incValue","setFont","setFontSize","setUseORP","setSlowDownOnLongWords","SentenceTokenizer","trim","array","length","pop","shift","tokenize","text","tokens","match","map","Function","prototype","call","this","findFile","archive","filename","files","result","filter","_","file","name","toLowerCase","validateMimeType","a","mimeFile","async","validateRootFile","containerFile","xmlData","parsedXML","parser","ignoreAttributes","container","rootfiles","rootfile","rootFileInfo","rootFile","parseRootFile","XMLData","attributeNamePrefix","attrNodeName","textNodeName","ignoreNameSpace","parseAttributeValue","metadata","parseMetadata","spine","parseSpine","manifest","parseManifest","guide","parseGuide","processingItems","processItems","loadItems","items","foundCover","findCover","loadCover","cover","uidName","package","attr","entries","entry","parsedValue","Array","isArray","find","item","id","replace","toUpperCase","direction","toc","itemref","push","idref","reference","type","includes","split","path","filePath","href","join","blob","mime","lookup","slice","size","loadingItems","domParser","DOMParser","Promise","all","loadedItems","parsedItems","parseFromString","body","textContent","trimStart","trimEnd","replaceAll","reduce","acc","v","zip","JsZip","loadAsync","keys","parsedEpub","epubToTxt","useLibraryContext","LibraryProvider","isLoading","setIsLoading","library","setLibrary","localforage","data","coverBlob","URL","createObjectURL","loadBooks","from","parsedBooks","loadedBooks","book","totalWords","bookInfo","identifier","title","creator","totalSentences","info","coverUrl","console","log","newLibrary","deleteBook","getBook","useReadingStatsContext","ReadingStatsProvider","getBookStats","savedBookStat","newBookStat","currentWordIndex","currentSentenceIndex","setBookCurrentWordIndex","newWordIndex","updateBookCurrentWordIndex","currentBookStat","setBookSentenceWordIndex","newSentenceIndex","updateBookSentenceWordIndex","Providers","Settings","ReadingStats","canvasCtx","document","createElement","getContext","useTextMeasurer","fontFamily","textMetrics","measureText","Math","abs","actualBoundingBoxLeft","actualBoundingBoxRight","SentenceRow","style","index","className","cn","styles","sentenceRow","selected","currentIndex","onClick","onSentenceClick","sentences","VirtualBookPlayer","lineHeight","setLineHeight","fontName","div","innerHTML","position","top","left","appendChild","height","offsetHeight","removeChild","measureFontHeight","el","display","innerText","useTester","getItemSize","width","ceil","itemData","useMemo","b","onResize","estimatedItemSize","itemSize","bind","itemCount","list","overscanCount","SingleWordRender","word","indexOf","floor","ORP","lpad","rpad","padStart","substr","BookPlayer","isPlaying","bookText","onPlayerClick","onClickHandler","textPlayer","playing","_extends","target","i","arguments","source","hasOwnProperty","apply","_objectWithoutProperties","excluded","sourceKeys","_objectWithoutPropertiesLoose","getOwnPropertySymbols","sourceSymbolKeys","propertyIsEnumerable","fill","d","SvgMinusSolid","_ref","svgRef","titleId","props","focusable","role","xmlns","viewBox","ref","ForwardRef","SvgPlusSolid","completionRate","wordCount","toFixed","timeToRead","wordPerMinute","seconds1","temp","days","hours","minutes","seconds","secondsToStr","ReaderControls","speedDown","speedUp","togglePlay","wordsCount","completed","ttr","speedDownHanlder","e","preventDefault","stopPropagation","speedUpHanlder","topLine","controls","button","stats","bar","bottom","SvgCogSolid","SvgAngleLeftSolid","ReaderHeader","history","useHistory","goBack","never","MAX_SAFE_INTEGER","Reader","useParams","setBookInfo","bookItems","setBookItems","setBookText","setBookStat","then","setPlaying","options","now","Date","getTime","started","setStarted","setCheckTime","nextFireTime","setNextFireTime","isStarted","isStopped","start","currentTime","newNextFireTime","delay","max","stop","timeout","overdueCalls","userDelay","callback","error","overdueElapsedTime","newFireTime","setTimeout","clearTimeout","useAccurateTimer","prev","Book","wrapperRef","useRef","to","nocover","bookWrapper","x","y","author","useFileInput","input","multiple","onchange","event","click","Library","onAdd","onBookClick","header","add","listContainer","bottomMenu","App","component","reportWebVitals","onPerfEntry","getCLS","getFID","getFCP","getLCP","getTTFB","ReactDOM","render","StrictMode","getElementById"],"mappings":"sFACAA,EAAOC,QAAU,CAAC,UAAY,0BAA0B,QAAU,wBAAwB,SAAW,yBAAyB,OAAS,uBAAuB,eAAiB,+BAA+B,MAAQ,sBAAsB,IAAM,oBAAoB,OAAS,yB,mBCA/QD,EAAOC,QAAU,CAAC,UAAY,0BAA0B,KAAO,qBAAqB,MAAQ,sBAAsB,QAAU,wBAAwB,YAAc,4BAA4B,MAAQ,sBAAsB,OAAS,uBAAuB,OAAS,yB,mBCArQD,EAAOC,QAAU,CAAC,UAAY,0BAA0B,OAAS,uBAAuB,MAAQ,sBAAsB,IAAM,oBAAoB,cAAgB,8BAA8B,KAAO,qBAAqB,WAAa,6B,mBCAvOD,EAAOC,QAAU,CAAC,UAAY,0BAA0B,EAAI,kBAAkB,KAAO,qBAAqB,YAAc,4BAA4B,SAAW,2B,mBCA/JD,EAAOC,QAAU,CAAC,UAAY,0BAA0B,WAAa,2BAA2B,KAAO,qBAAqB,SAAW,yBAAyB,QAAU,0B,mBCA1KD,EAAOC,QAAU,CAAC,UAAY,0BAA0B,MAAQ,wB,mBCAhED,EAAOC,QAAU,CAAC,UAAY,4B,gMCEf,SAASC,IACpB,IAAMC,EAAMC,6BAA6BC,GAQzC,MAAO,CAPP,WACI,IAAMC,EAAIC,qBAAWJ,GACrB,QAAUE,IAANC,EACA,MAAM,IAAIE,MAAM,iDAEpB,OAAOF,GAEKH,EAAIM,U,WCelBC,EAAkB,CACpBC,KAAM,UACNC,SAAU,GACVC,eAAgB,IAChBC,QAAQ,EACRC,qBAAqB,G,EAGcb,I,mBAAhCc,E,KAAoBP,E,KAgHZQ,EA9GU,SAAC,GAA0C,IAAxCC,EAAuC,EAAvCA,SAAuC,EAC/BC,mBAA2B,MADI,mBACxDC,EADwD,KAC9CC,EAD8C,KAG/DC,qBAAU,WACN,IAAMF,EAA+B,GAGjBG,EAEhBb,EAFAG,eACGW,EALK,YAMRd,EANQ,oBAQNe,EAAiBC,aAAaC,QAAQ,YACvCF,EAODG,OAAOC,OAAOT,EAAUU,KAAKC,MAAMN,KANnCC,aAAaM,QACT,WACAF,KAAKG,UAAUT,IAEnBI,OAAOC,OAAOT,EAAUI,IAK5B,IAAMU,EAAuBR,aAAaC,QAAQ,kBAC7CO,EAODd,EAASP,eAAiBsB,OAAOD,IANjCR,aAAaM,QACT,iBACAI,OAAOb,IAEXH,EAASP,eAAiBU,GAK9BF,EAAYD,KACb,IAEH,IAAMiB,EAAaC,uBACf,SAA4BC,EAAQC,GAChCnB,GAAY,SAACoB,GACT,OAAKA,GAGO,mBAARF,EACAb,aAAaM,QAAQ,iBAAkBI,OAAOI,IAE9Cd,aAAaM,QACT,WACAF,KAAKG,UAAL,2BAAoBQ,GAApB,kBAAsCF,EAAMC,MAG7C,2BAAKC,GAAZ,kBAA8BF,EAAMC,KAVzB,UAanB,IAGEE,EAAoBJ,uBACtB,SAACK,GAAD,OAAsBN,EAAW,iBAAkBM,KACnD,CAACN,IAECO,EAAuBN,uBACzB,SAACO,GAAD,OACIR,EACI,mBACS,OAARjB,QAAQ,IAARA,OAAA,EAAAA,EAAUP,iBAAkBH,EAAgBG,gBACzCgC,KAEZ,QAACzB,QAAD,IAACA,OAAD,EAACA,EAAUP,eAAgBwB,IAGzBS,EAAUR,uBACZ,SAACK,GAAD,OAAsBN,EAAW,OAAQM,KACzC,CAACN,IAECU,EAAcT,uBAChB,SAACK,GAAD,OAAsBN,EAAW,WAAYM,KAC7C,CAACN,IAECW,EAAYV,uBACd,SAACK,GAAD,OAAuBN,EAAW,SAAUM,KAC5C,CAACN,IAECY,EAAyBX,uBAC3B,SAACK,GAAD,OAAuBN,EAAW,sBAAuBM,KACzD,CAACN,IAGL,OAAKjB,EAKD,cAACX,EAAD,CACI+B,MAAO,CACHpB,WACAsB,oBACAE,uBACAE,UACAC,cACAC,YACAC,0BARR,SAWK/B,IAfE,M,2GCtHTgC,EAAoB,aAG1BA,EAAkBC,KAAO,SAAUC,GAC/B,KAAmC,KAA5BA,EAAMA,EAAMC,OAAS,IAAaD,EAAME,MAC/C,KAAoB,KAAbF,EAAM,IAAaA,EAAMG,QAChC,OAAOH,GAGXF,EAAkBM,SAAW,SAAUC,GAEnC,IAAIC,EAASD,EAAKE,MAAM,+IAExB,OAAKD,GAKLA,EAASA,EAAOE,IAAIC,SAASC,UAAUC,KAAM3B,OAAO0B,UAAUX,MAEvDa,KAAKb,KAAKO,IANR,CAACD,IASCP,QC+Ef,SAASe,EAASC,EAAgBC,GAC9B,GAAID,EAAQE,MAAMD,GACd,OAAOD,EAAQE,MAAMD,GAEzB,IAAME,EAASH,EAAQI,QACnB,SAACC,EAAGC,GAAJ,OAAaA,EAAKC,KAAKC,gBAAkBP,EAASO,iBAEtD,OAAIL,EAAOhB,OAAS,EACTgB,EAAO,GAEX,K,SAGIM,E,8EAAf,WAAgCT,GAAhC,eAAAU,EAAA,yDACUC,EAAWZ,EAASC,EAAS,YADvC,sBAGc,IAAI1D,MAAM,+BAHxB,uBAM+BqE,EAASC,MAAM,QAN9C,UAQ8C,yBAR9C,OAQqBJ,cAAcvB,OARnC,sBASc,IAAI3C,MAAM,yBATxB,4C,+BAaeuE,E,8EAAf,WAAgCb,GAAhC,yBAAAU,EAAA,yDACUI,EAAgBf,EAASC,EAAS,0BAD5C,sBAGc,IAAI1D,MAAM,gCAHxB,uBAM0BwE,EAAcF,MAAM,QAN9C,UAMUG,EANV,QAOUC,EAAYC,IAAOpD,MAAMkD,EAAS,CAAEG,kBAAkB,KAG7CC,UAAUC,WACpBJ,EAAUG,UAAUC,UAAUC,SAXvC,sBAac,IAAI/E,MAAM,sBAbxB,UAmByC,mCAH/BgF,EAAeN,EAAUG,UAAUC,UAAUC,UAGlC,gBAnBrB,uBAoBc,IAAI/E,MAAM,8BApBxB,WAuBI2D,EAAWqB,EAAa,eAvB5B,uBA0Bc,IAAIhF,MAAM,kBA1BxB,WA6BUiF,EAAWxB,EAASC,EAASC,GA7BvC,uBA+Bc,IAAI3D,MAAM,mCA/BxB,iCAkCWiF,GAlCX,6C,+BAqCeC,E,gFAAf,WAA6BxB,EAAgBuB,GAA7C,iCAAAb,EAAA,sEACuBa,EAASX,MAAM,QADtC,cACUrB,EADV,OAEUkC,EAAUR,IAAOpD,MAAM0B,EAAM,CAC/BmC,oBAAqB,GACrBC,aAAc,OACdC,aAAc,QACdV,kBAAkB,EAClBW,iBAAiB,EACjBC,qBAAqB,IAGnBC,EAAWC,EAAcP,GACzBQ,EAAQC,EAAWT,GACnBU,EAAWC,EAAcX,GACzBY,EAAQC,EAAWb,GAEnBc,EAAkBC,EAAaL,EAAUF,GAhBnD,UAiBwBQ,EAAUzC,EAASuB,EAAUgB,GAjBrD,eAiBUG,EAjBV,OAmBUC,EAAaC,EAAUT,EAAUE,GAnB3C,UAoBwBQ,EAAU7C,EAASuB,EAAUoB,GApBrD,eAoBUG,EApBV,yBAsBW,CACHA,QACAf,WACAW,UAzBR,6C,sBA6BA,SAASV,EAAcP,GAOnB,IANA,IAAMM,EAAmC,GAEnCgB,EAAUtB,EAAQuB,QAAQC,KAAK,qBAIrC,MAHgBvF,OAAOwF,QACnBzB,EAAQuB,QAAQjB,UAEpB,eAA6B,CAAxB,IAAMoB,EAAK,KACZ,GAAIA,EAAO,CAAC,IAAD,cACcA,EADd,GACA9E,EADA,KACKC,EADL,KAGP,GAAIA,EAAO,CACP,IAAI8E,EAAc,KAClB,GAAY,eAAR/E,EAAsB,CAYtB,GAXA+E,EAAc9E,EACV+E,MAAMC,QAAQhF,IACd8E,EAAe9E,EAA+BiF,MAC1C,SAACC,GAAD,OAAUA,EAAKP,KAAKQ,KAAOV,QAG3BK,EAAcA,EAAY9E,OAG9B8E,EAAe9E,EAA6BA,OAE5C8E,EAMA,MAAM,IAAI9G,MACN,2CANJ8G,EAAclF,OAAOkF,GAChBM,QAAQ,YAAa,IACrBC,cACA1E,YASLmE,EAFiB,kBAAV9E,EAEQA,EAAcA,MAEfA,EAGtByD,EAAS1D,GAA8B+E,IAKnD,OAAOrB,EAGX,SAASG,EAAWT,GAChB,IAAMQ,EAA6B,CAC/BS,MAAO,IAaX,GAXI,OAAQjB,EAAQuB,QAAQf,MAAMgB,OAC9BhB,EAAMwB,GAAKhC,EAAQuB,QAAQf,MAAMgB,KAAKQ,IAEtC,+BAAgChC,EAAQuB,QAAQf,MAAMgB,OACtDhB,EAAM2B,UACFnC,EAAQuB,QAAQf,MAAMgB,KAAK,+BAE/B,QAASxB,EAAQuB,QAAQf,MAAMgB,OAC/BhB,EAAM4B,IAAMpC,EAAQuB,QAAQf,MAAMgB,KAAKY,KAGvCR,MAAMC,QAAQ7B,EAAQuB,QAAQf,MAAM6B,SAAU,CAAC,IAAD,gBAC3BrC,EAAQuB,QAAQf,MAAM6B,SADK,IAC9C,2BAAkD,CAAC,IAAD,EAAvCN,EAAuC,QAC9C,UAAAvB,EAAMS,aAAN,SAAaqB,KAAKP,EAAKP,KAAKe,QAFc,mCAI3C,CAAC,IAAD,EACH,UAAA/B,EAAMS,aAAN,SAAaqB,KAAKtC,EAAQuB,QAAQf,MAAM6B,QAAQb,KAAKe,OAGzD,OAAO/B,EAGX,SAASG,EAAcX,GACnB,IADsC,EAChCU,EAA0B,GADM,cAEnBV,EAAQuB,QAAQb,SAASqB,MAFN,IAEtC,2BAAkD,CAAC,IAAxCA,EAAuC,QAC9CrB,EAAS4B,KAAKP,EAAKP,OAHe,8BAKtC,OAAOd,EAGX,SAASG,EAAWb,GAChB,GAAKA,EAAQuB,QAAQX,OAA0C,kBAA1BZ,EAAQuB,QAAQX,MAIrD,OAAOZ,EAAQuB,QAAQX,MAAM4B,UAAUhB,KAK3C,SAASL,EAAUT,EAAyBE,GACxC,GAAIA,GAAwB,UAAfA,EAAM6B,KACf,OAAO7B,EAFiD,oBAIzCF,GAJyC,IAI5D,2BAA6B,CAAC,IAAnBqB,EAAkB,QACzB,GAAIA,EAAKC,GAAGU,SAAS,aACjB,OAAOX,GAN6C,+BAUhE,SAAShB,EAAaL,EAAyBF,GAC3C,IAD8D,EACxDS,EAAQ,GADgD,cAE7CT,EAAMS,OAFuC,yBAEnDe,EAFmD,QAGpDD,EAAOrB,EAASoB,MAAK,SAACC,GAAD,OAAUA,EAAKC,KAAOA,KAC7CD,GAA+B,0BAAvBA,EAAK,eACbd,EAAMqB,KAAKP,IAHnB,2BAA+B,IAF+B,8BAQ9D,OAAOd,E,SAKIG,E,kFAAf,WACI7C,EACAuB,EACAuB,GAHJ,yBAAApC,EAAA,yDAKSoC,EALT,yCAMe,MANf,uBASsBvB,QATtB,IASsBA,OATtB,EASsBA,EAAUhB,KAAK6D,MAAM,KAT3C,mBASWC,EATX,UAUUC,EAAW,CAACD,EAAMvB,EAAMyB,MAAMC,KAAK,KAV7C,SAWuBxE,EAAQE,MAAMoE,GAAU1D,MAAM,QAXrD,UAWU6D,EAXV,OAaUP,EAAOpB,EAAM,eAAiB4B,IAAKC,OAAO7B,EAAMyB,MAb1D,0CAgBeE,GAhBf,iCAmBWA,EAAKG,MAAM,EAAGH,EAAKI,KAAMX,IAnBpC,6C,+BAsBezB,E,kFAAf,WACIzC,EACAuB,EACAgB,GAHJ,mCAAA7B,EAAA,+DAKsBa,QALtB,IAKsBA,OALtB,EAKsBA,EAAUhB,KAAK6D,MAAM,KAL3C,mBAKWC,EALX,UAOUS,EAAe,GAPzB,cAQ2BvC,GAR3B,IAQI,2BAAagC,EAA2B,QAA3BA,KACHD,EAAW,CAACD,EAAME,GAAMC,KAAK,KACnCM,EAAaf,KAAK/D,EAAQE,MAAMoE,GAAU1D,MAAM,SAVxD,qCAYUmE,EAAY,IAAIC,UAZ1B,SAa8BC,QAAQC,IAAIJ,GAb1C,cAaUK,EAbV,OAcUC,EAAcD,EACfzF,KAAI,SAAC8D,GAAD,eACDxE,EAAkBM,WAEV,UAAAyF,EACKM,gBAAgB7B,EAAM,yBACtB8B,KAAKC,mBAFV,mBAEuBC,mBAFvB,eAGMC,WAAY,KAEjBrB,MAAM,MACNI,KAAK,OAET9E,KAAI,SAAC8D,GAAD,OAAUA,EAAKkC,WAAW,MAAO,QACrCtF,QAAO,SAACoD,GAAD,MAAmB,MAATA,QAEzBmC,QAAO,SAACC,EAAKC,GAAN,4BAAgBD,GAAhB,YAAwBC,MAAI,IA7B5C,kBA8BWT,GA9BX,6C,kEAiCA,WAAyBX,GAAzB,qBAAA/D,EAAA,yDACsB,yBAAd+D,EAAKP,KADb,sBAEc,IAAI5H,MAAM,oBAFxB,cAKUwJ,EAAM,IAAIC,IALpB,SAM0BD,EAAIE,UAAUvB,GANxC,UAMUzE,EANV,OAQ8C,IAAtCtC,OAAOuI,KAAKjG,EAAQE,OAAOf,OARnC,sBASc,IAAI7C,MAAM,uBATxB,wBAYUmE,EAAiBT,GAZ3B,yBAa2Ba,EAAiBb,GAb5C,eAaUuB,EAbV,iBAc6BC,EAAcxB,EAASuB,GAdpD,eAcU2E,EAdV,yBAgBWA,GAhBX,6C,sBAmBeC,O,+CChWuBnK,I,qBAA/BoK,G,MAAmB7J,G,MAsIX8J,GApIS,SAAC,GAAyC,IAAvCrJ,EAAsC,EAAtCA,SAAsC,EAC3BC,oBAAS,GADkB,mBACtDqJ,EADsD,KAC3CC,EAD2C,OAE/BtJ,mBAAsB,IAFS,mBAEtDuJ,EAFsD,KAE7CC,EAF6C,KAI7DrJ,qBAAU,WACN,sBAAC,oCAAAsD,EAAA,sEACsBgG,IAAYjJ,QAAqB,WADvD,OACSkJ,EADT,OAEGF,EAAYE,GAAgB,IAF/B,cAIqBA,GAAQ,IAJ7B,gEAIYnD,EAJZ,kBAK+BkD,IAAYjJ,QAAZ,UAAuB+F,EAAKC,GAA5B,WAL/B,SAKamD,EALb,UAOYpD,EAAaV,MAAQ+D,IAAIC,gBAAgBF,IAPrD,+IAUGL,GAAa,GAVhB,+DAAD,KAYD,IAaH,IAAMQ,EAAY3I,sBAAW,uCACzB,WAAO8B,GAAP,mBAAAQ,EAAA,sEAC8BuE,QAAQC,IAC9B7B,MAAM2D,KAAK9G,GAAOR,KAAI,SAACY,GAAD,OAAU6F,GAAU7F,OAFlD,cACU2G,EADV,OAKUC,EAAcD,EAAYvH,KAAI,SAACyH,GACjC,IAAMC,EAAaD,EAAKzE,MAAMiD,QAC1B,SAACC,EAAKpC,GAAN,OAAeoC,EAAMpC,EAAKY,MAAM,KAAKjF,SACrC,GAGEkI,EAAW,CACb5D,GAAI0D,EAAKpF,SAASuF,WAClBC,MAAOJ,EAAKpF,SAASwF,OAAS,GAC9BC,QAASL,EAAKpF,SAASyF,SAAW,GAClC1E,QAASqE,EAAKrE,MAEdsE,aACAK,eAAgBN,EAAKzE,MAAMvD,QAG/B,MAAO,CACHsE,GAAI4D,EAAS5D,GACbiE,KAAML,EACN3E,MAAOyE,EAAKzE,MACZI,MAAOqE,EAAKrE,MACZ6E,WAAUR,EAAKrE,OACT+D,IAAIC,gBAAgBK,EAAKrE,WA3B3C,SAgCUmC,QAAQC,IACVgC,EAAYxH,KAAI,gBAAG+D,EAAH,EAAGA,GAAIf,EAAP,EAAOA,MAAP,OACZgE,IAAY5I,QAAQ2F,EAAIf,OAlCpC,cAsCIkF,QAAQC,IAAIX,GAENY,EAxCV,sBAyCWtB,GAzCX,YA0CWU,EAAYxH,KAAI,qBAAGgI,UA1C9B,UA4CUhB,IAAY5I,QAAQ,UAAWgK,GA5CzC,yBA8CU7C,QAAQC,IACVgC,EACK9G,QAAO,sBAAG0C,SACVpD,KAAI,gBAAG+D,EAAH,EAAGA,GAAIX,EAAP,EAAOA,MAAP,OACD4D,IAAY5I,QAAZ,UAAuB2F,EAAvB,UAAmCX,OAlDnD,QAsDI2D,EAAW,GAAD,mBACHD,GADG,YAEHU,EAAYxH,KAAI,gBAAGgI,EAAH,EAAGA,KAAMC,EAAT,EAASA,SAAT,mBAAC,eACbD,GADY,IAEf5E,MAAO6E,UA1DnB,4CADyB,sDA+DzB,CAACnB,IAGCuB,EAAa3J,uBAAY,SAACqF,MAAmB,IAE7CuE,EAAU5J,sBAAW,uCACvB,WAAOqF,GAAP,iBAAA/C,EAAA,sEACyBgG,IAAYjJ,QAAkBgG,GADvD,gDAC+D,GAD/D,cACUf,EADV,KAEUgF,EAAOlB,EAASjD,MAAK,SAACC,GAAD,OAAUA,EAAKC,KAAOA,KAFrD,kBAGW,CACHiE,OACAhF,UALR,2CADuB,sDASvB,CAAC8D,IAGL,OAAIF,EACO,KAIP,cAAC,GAAD,CACIhI,MAAO,CACHkI,UAEAO,YACAgB,aAEAC,WAPR,SAUKhL,K,GCpJ8BhB,I,qBAApCiM,G,MAAwB1L,G,MA6GhB2L,GA3Gc,SAAC,GAA8C,IAA5ClL,EAA2C,EAA3CA,SACtBmL,EAAe/J,uBAAY,SAACqF,GAC9B,IAAM2E,EAAgB5K,aAAaC,QAAQgG,GAC3C,IAAK2E,EAAe,CAChB,IAAMC,EAAc,CAChBC,iBAAkB,EAClBC,qBAAsB,GAG1B,OADA/K,aAAaM,QAAQ2F,EAAI7F,KAAKG,UAAUsK,IACjCA,EAEX,OAAOzK,KAAKC,MAAMuK,KACnB,IAEGI,EAA0BpK,uBAC5B,SAACqF,EAAYgF,GACT,IAAML,EAAgB5K,aAAaC,QAAQgG,GACtC2E,GAGL5K,aAAaM,QACT2F,EACA7F,KAAKG,UAAL,2BACOH,KAAKC,MAAMuK,IADlB,IAEIE,iBAAkBG,QAI9B,IAGEC,EAA6BtK,uBAC/B,SAACqF,EAAY9E,GACT,IAAMyJ,EAAgB5K,aAAaC,QAAQgG,GAC3C,IAAK2E,EACD,OAAO,EAEX,IAAMO,EAAkB/K,KAAKC,MAAMuK,GAC7BE,EACFK,EAAgBL,iBAAmB3J,EAQvC,OAPAnB,aAAaM,QACT2F,EACA7F,KAAKG,UAAU,CACX4K,kBACAL,sBAGDA,IAEX,IAGEM,EAA2BxK,uBAC7B,SAACqF,EAAYoF,GACT,IAAMT,EAAgB5K,aAAaC,QAAQgG,GACtC2E,GAGL5K,aAAaM,QACT2F,EACA7F,KAAKG,UAAL,2BACOH,KAAKC,MAAMuK,IADlB,IAEIG,qBAAsBM,QAIlC,IAGEC,EAA8B1K,uBAChC,SAACqF,EAAY9E,GACT,IAAMyJ,EAAgB5K,aAAaC,QAAQgG,GAC3C,IAAK2E,EACD,OAAO,EAEX,IAAMO,EAAkB/K,KAAKC,MAAMuK,GAC7BG,EACFI,EAAgBJ,qBAAuB5J,EAQ3C,OAPAnB,aAAaM,QACT2F,EACA7F,KAAKG,UAAU,CACX4K,kBACAJ,0BAGDA,IAEX,IAGJ,OACI,cAAC,GAAD,CACIjK,MAAO,CACH6J,eACAK,0BACAE,6BACAE,2BACAE,+BANR,SASK9L,KCrGE+L,GAZG,SAAC,GAAmC,IAAjC/L,EAAgC,EAAhCA,SACjB,OACI,cAAC,IAAD,UACI,cAACgM,EAAD,UACI,cAACC,GAAD,UACI,cAAC,GAAD,UAAkBjM,W,8ECZhCkM,GAAYC,SAASC,cAAc,UAAUC,WAAW,MAgB/CC,OAdf,WAUI,OARgBlL,uBAAY,SAACmL,EAAoB7M,EAAkB6C,GAE/D2J,GAAWzM,KAAX,UAAqBC,EAArB,cAAmC6M,GACnC,IAAMC,EAAcN,GAAWO,YAAYlK,GAE3C,OADcmK,KAAKC,IAAIH,EAAYI,uBAAyBF,KAAKC,IAAIH,EAAYK,0BAElF,KC0BP,IAAMC,GAAc,SAAC,GAAiC,IAA/BC,EAA8B,EAA9BA,MAAOpD,EAAuB,EAAvBA,KAAMqD,EAAiB,EAAjBA,MAChC,OACI,qBACIC,UAAWC,KAAGC,KAAOC,YAAR,eACRD,KAAOE,SAAWL,IAAUrD,EAAK2D,eAEtCC,QAAS,kBAAM5D,EAAK6D,gBAAgBR,IACpCD,MAAOA,EALX,SAOKpD,EAAK8D,UAAUT,MAe5B,IA8EeU,GA9EW,SAAC,GAMF,IAAD,IALpBnB,kBAKoB,MALP,UAKO,MAJpB7M,gBAIoB,MAJT,GAIS,EAHpB+N,EAGoB,EAHpBA,UACAH,EAEoB,EAFpBA,aACAE,EACoB,EADpBA,gBACoB,EAEgBvN,mBAASP,GAFzB,mBAEbiO,EAFa,KAEDC,EAFC,KAGpBxN,qBAAU,WACNwN,EAtDR,SAA2BC,EAAkBnO,GAGzC,IAAIoO,EAAM3B,SAASC,cAAc,OACjC0B,EAAIrH,GAAK,gBACTqH,EAAIC,UAAY,wDAChBD,EAAIf,MAAMiB,SAAW,WACrBF,EAAIf,MAAMkB,IAAM,SAChBH,EAAIf,MAAMmB,KAAO,IACjBJ,EAAIf,MAAMR,WAAasB,EACvBC,EAAIf,MAAMrN,SAAWA,EAAW,KAChCyM,SAAS7D,KAAK6F,YAAYL,GAE1B,IAAMM,EAASN,EAAIO,aAInB,OAFAlC,SAAS7D,KAAKgG,YAAYR,GAEnBM,EAqCWG,CAAkBhC,EAAY7M,MAC7C,CAAC6M,EAAY7M,IArBpB,WACI,IAAM8O,EAAKrC,SAASC,cAAc,OAClCoC,EAAGzB,MAAMR,WAAa,UACtBiC,EAAGzB,MAAMrN,SAAW,OACpB8O,EAAGzB,MAAM0B,QAAU,QACnBD,EAAGE,UACC,4MAiBJC,GAEA,IAAMlC,EAAcH,KACdsC,EAAcxN,uBAChB,SAACyN,EAAe7B,GAgBZ,OAdc,IAAVA,GACApC,QAAQC,IACJ6B,KAAKoC,KACDrC,EAAYF,EAAY7M,EAAU+N,EAAUT,KAC5C6B,GAGOnC,KAAKoC,MACnBpC,KAAKoC,KACFrC,EAAYF,EAAY7M,EAAU+N,EAAUT,IAAU6B,GAEtD,GACAlB,KAIZ,CAACF,EAAW/N,EAAU6M,EAAYE,IAGhCsC,EAAWC,mBACb,iBAAO,CACHvB,YACAH,eACAE,qBAEJ,CAACC,EAAWH,EAAcE,IAG9B,OACI,qBACIP,UAAWE,KAAOhJ,UAClB4I,MAAO,CACHR,WAAYA,EACZ7M,SAAS,GAAD,OAAKA,EAAL,OAJhB,SAOI,qBAAKuN,UAAWE,KAAO8B,EAAvB,SACI,cAAC,KAAD,CAAWC,SAAU,kBAAMtE,QAAQC,IAAI,WAAvC,SACK,gBAAGuD,EAAH,EAAGA,OAAQS,EAAX,EAAWA,MAAX,OACG,cAAC,KAAD,CACIT,OAAQA,EACRS,MAAOA,EACPE,SAAUA,EACVI,kBAA8B,IAAXzP,EACnB0P,SAAUR,EAAYS,KAAK,KAAMR,GACjCS,UAAW7B,EAAUtL,OACrB8K,UAAWE,KAAOoC,KAClBC,cAAe,GARnB,SAWK1C,a,MClH7B,IAyBe2C,GAzBU,SAAC,GAAiC,IAA/BC,EAA8B,EAA9BA,KAElBtI,EAZV,SAAasI,GAET,IADA,IAAIvN,EAASuN,EAAKvN,QAC6B,IAAzC,YAAYwN,QAAQD,IAAOvN,MACjC,SAASA,GACP,KAAK,EAAG,KAAK,EAAG,OAAO,EACvB,KAAK,EAAG,KAAK,EAAG,OAAO,EACvB,QAAS,OAAOuK,KAAKkD,MAAMzN,EAAS,GAAK,GAM7B0N,CAAIH,GACZvN,EAASuN,EAAKvN,OAChB2N,EAAO,GACPC,EAAO,GAWX,OATe,IAAX5N,EACA4N,EAAO,OACW,IAAX5N,GAA2B,IAAXA,IAEvB2N,EAAO,GAAGE,SADH7N,EAAS,EACGuK,KAAKkD,MAAMzN,EAAS,GAAKiF,EAAQ,EAEjCsF,KAAKkD,MAAMzN,EAAS,GAAKiF,EAFW,SAMvD,sBAAK6F,UAAU,OAAf,UACK6C,EAAOJ,EAAKO,OAAO,EAAG7I,GACvB,sBAAM6F,UAAU,WAAhB,SAA4ByC,EAAKO,OAAO7I,EAAO,KAC9CsI,EAAKO,OAAO7I,EAAQ,GAAK2I,M,oBC4BvBG,GAzBI,SAAC,GAKK,IAJrBC,EAIoB,EAJpBA,UACAC,EAGoB,EAHpBA,SACA9E,EAEoB,EAFpBA,iBACA+E,EACoB,EADpBA,cAEMC,EAAiBlP,uBAAY,WAC3B+O,GACAE,MAEL,CAACF,EAAWE,IAEf,OACI,qBAAKpD,UAAWE,KAAOhJ,UAAWoJ,QAAS+C,EAA3C,SACI,qBACIrD,UAAWC,KAAGC,KAAOoD,WAAR,eACRpD,KAAOqD,QAAUL,IAF1B,SAKI,cAAC,GAAD,CAAkBT,KAAMU,EAAS9E,UC3DjD,SAASmF,KAA2Q,OAA9PA,GAAW/P,OAAOC,QAAU,SAAU+P,GAAU,IAAK,IAAIC,EAAI,EAAGA,EAAIC,UAAUzO,OAAQwO,IAAK,CAAE,IAAIE,EAASD,UAAUD,GAAI,IAAK,IAAItP,KAAOwP,EAAcnQ,OAAOkC,UAAUkO,eAAejO,KAAKgO,EAAQxP,KAAQqP,EAAOrP,GAAOwP,EAAOxP,IAAY,OAAOqP,IAA2BK,MAAMjO,KAAM8N,WAEhT,SAASI,GAAyBH,EAAQI,GAAY,GAAc,MAAVJ,EAAgB,MAAO,GAAI,IAAkExP,EAAKsP,EAAnED,EAEzF,SAAuCG,EAAQI,GAAY,GAAc,MAAVJ,EAAgB,MAAO,GAAI,IAA2DxP,EAAKsP,EAA5DD,EAAS,GAAQQ,EAAaxQ,OAAOuI,KAAK4H,GAAqB,IAAKF,EAAI,EAAGA,EAAIO,EAAW/O,OAAQwO,IAAOtP,EAAM6P,EAAWP,GAAQM,EAAStB,QAAQtO,IAAQ,IAAaqP,EAAOrP,GAAOwP,EAAOxP,IAAQ,OAAOqP,EAFxMS,CAA8BN,EAAQI,GAAuB,GAAIvQ,OAAO0Q,sBAAuB,CAAE,IAAIC,EAAmB3Q,OAAO0Q,sBAAsBP,GAAS,IAAKF,EAAI,EAAGA,EAAIU,EAAiBlP,OAAQwO,IAAOtP,EAAMgQ,EAAiBV,GAAQM,EAAStB,QAAQtO,IAAQ,GAAkBX,OAAOkC,UAAU0O,qBAAqBzO,KAAKgO,EAAQxP,KAAgBqP,EAAOrP,GAAOwP,EAAOxP,IAAU,OAAOqP,EAMne,IAAI,GAAqB,gBAAoB,OAAQ,CACnDa,KAAM,eACNC,EAAG,yHAGL,SAASC,GAAcC,EAAMC,GAC3B,IAAIpH,EAAQmH,EAAKnH,MACbqH,EAAUF,EAAKE,QACfC,EAAQb,GAAyBU,EAAM,CAAC,QAAS,YAErD,OAAoB,gBAAoB,MAAOjB,GAAS,CACtD,cAAe,OACfqB,UAAW,QACX,cAAe,MACf,YAAa,QACb7E,UAAW,kCACX8E,KAAM,MACNC,MAAO,6BACPC,QAAS,cACTC,IAAKP,EACL,kBAAmBC,GAClBC,GAAQtH,EAAqB,gBAAoB,QAAS,CAC3D9D,GAAImL,GACHrH,GAAS,KAAM,IAGpB,IAAI4H,GAA0B,aAAiBV,IAChC,ICnCf,SAAS,KAA2Q,OAA9P,GAAW/Q,OAAOC,QAAU,SAAU+P,GAAU,IAAK,IAAIC,EAAI,EAAGA,EAAIC,UAAUzO,OAAQwO,IAAK,CAAE,IAAIE,EAASD,UAAUD,GAAI,IAAK,IAAItP,KAAOwP,EAAcnQ,OAAOkC,UAAUkO,eAAejO,KAAKgO,EAAQxP,KAAQqP,EAAOrP,GAAOwP,EAAOxP,IAAY,OAAOqP,IAA2BK,MAAMjO,KAAM8N,WAEhT,SAAS,GAAyBC,EAAQI,GAAY,GAAc,MAAVJ,EAAgB,MAAO,GAAI,IAAkExP,EAAKsP,EAAnED,EAEzF,SAAuCG,EAAQI,GAAY,GAAc,MAAVJ,EAAgB,MAAO,GAAI,IAA2DxP,EAAKsP,EAA5DD,EAAS,GAAQQ,EAAaxQ,OAAOuI,KAAK4H,GAAqB,IAAKF,EAAI,EAAGA,EAAIO,EAAW/O,OAAQwO,IAAOtP,EAAM6P,EAAWP,GAAQM,EAAStB,QAAQtO,IAAQ,IAAaqP,EAAOrP,GAAOwP,EAAOxP,IAAQ,OAAOqP,EAFxM,CAA8BG,EAAQI,GAAuB,GAAIvQ,OAAO0Q,sBAAuB,CAAE,IAAIC,EAAmB3Q,OAAO0Q,sBAAsBP,GAAS,IAAKF,EAAI,EAAGA,EAAIU,EAAiBlP,OAAQwO,IAAOtP,EAAMgQ,EAAiBV,GAAQM,EAAStB,QAAQtO,IAAQ,GAAkBX,OAAOkC,UAAU0O,qBAAqBzO,KAAKgO,EAAQxP,KAAgBqP,EAAOrP,GAAOwP,EAAOxP,IAAU,OAAOqP,EAMne,IAAI,GAAqB,gBAAoB,OAAQ,CACnDa,KAAM,eACNC,EAAG,oPAGL,SAASY,GAAaV,EAAMC,GAC1B,IAAIpH,EAAQmH,EAAKnH,MACbqH,EAAUF,EAAKE,QACfC,EAAQ,GAAyBH,EAAM,CAAC,QAAS,YAErD,OAAoB,gBAAoB,MAAO,GAAS,CACtD,cAAe,OACfI,UAAW,QACX,cAAe,MACf,YAAa,OACb7E,UAAW,iCACX8E,KAAM,MACNC,MAAO,6BACPC,QAAS,cACTC,IAAKP,EACL,kBAAmBC,GAClBC,GAAQtH,EAAqB,gBAAoB,QAAS,CAC3D9D,GAAImL,GACHrH,GAAS,KAAM,IAGpB,IAAI,GAA0B,aAAiB6H,I,IAChC,I,kBCdR,SAASC,GAAeC,EAAmBhH,GAC9C,OAASA,EAAmBgH,EAAa,KAAKC,QAAQ,GAGnD,SAASC,GACZF,EACAhH,EACAmH,GAEA,OA9BJ,SAAsBC,GAClB,IAAIC,EAAOD,EACPE,EAAOlG,KAAKkD,OAAO+C,GAAQ,SAAY,OAC3C,GAAIC,EACA,OAAOA,EAAO,KAElB,IAAIC,EAAQnG,KAAKkD,OAAO+C,GAAQ,OAAS,MACzC,GAAIE,EACA,OAAOA,EAAQ,KAEnB,IAAIC,EAAUpG,KAAKkD,OAAO+C,GAAQ,MAAQ,IAC1C,GAAIG,EACA,OAAOA,EAAU,KAErB,IAAIC,EAAUJ,EAAO,GACrB,OAAII,EACOA,EAAU,KAEd,GAYAC,CACHtG,KAAKkD,OAAO0C,EAAYhH,IAAqBmH,EAAgB,MCVrE,IAiDeQ,GAjDQ,SAAC,GAUK,IATzB9C,EASwB,EATxBA,UAEA+C,EAOwB,EAPxBA,UACAC,EAMwB,EANxBA,QACAC,EAKwB,EALxBA,WAEAC,EAGwB,EAHxBA,WACA/F,EAEwB,EAFxBA,aACA3N,EACwB,EADxBA,eAEM2T,EAAYjB,GAAegB,EAAY/F,GACvCiG,EAAMf,GAAWa,EAAY/F,EAAc3N,GAE3C6T,EAAmBpS,uBAAY,SAACqS,GAClCA,EAAEC,iBACFD,EAAEE,kBACFT,MACD,CAACA,IAEEU,EAAiBxS,uBAAY,SAACqS,GAChCA,EAAEC,iBACFD,EAAEE,kBACFR,MACD,CAACA,IAEJ,OAAGhD,EACQ,KAIP,sBAAKlD,UAAWE,KAAOhJ,UAAWoJ,QAAS6F,EAA3C,UACI,qBAAKnG,UAAWE,KAAO0G,UACvB,sBAAK5G,UAAWE,KAAO2G,SAAvB,UACI,cAAC,GAAD,CAAW7G,UAAWE,KAAO4G,OAAQxG,QAASiG,IAC9C,sBAAKvG,UAAWE,KAAOxN,eAAvB,UAAwCA,EAAxC,IAAwD,uBAAxD,aACA,cAAC,GAAD,CAAUsN,UAAWE,KAAO4G,OAAQxG,QAASqG,OAEjD,sBAAK3G,UAAWE,KAAO6G,MAAvB,UACI,qBAAK/G,UAAWE,KAAO8G,IAAKlH,MAAO,CAAE,UAAU,GAAV,OAAcuG,EAAd,QACrC,sBAAKrG,UAAWE,KAAO+G,OAAvB,UACI,8BAAMX,IACN,gCAAMD,EAAN,iBC/DpB,SAAS,KAA2Q,OAA9P,GAAW5S,OAAOC,QAAU,SAAU+P,GAAU,IAAK,IAAIC,EAAI,EAAGA,EAAIC,UAAUzO,OAAQwO,IAAK,CAAE,IAAIE,EAASD,UAAUD,GAAI,IAAK,IAAItP,KAAOwP,EAAcnQ,OAAOkC,UAAUkO,eAAejO,KAAKgO,EAAQxP,KAAQqP,EAAOrP,GAAOwP,EAAOxP,IAAY,OAAOqP,IAA2BK,MAAMjO,KAAM8N,WAEhT,SAAS,GAAyBC,EAAQI,GAAY,GAAc,MAAVJ,EAAgB,MAAO,GAAI,IAAkExP,EAAKsP,EAAnED,EAEzF,SAAuCG,EAAQI,GAAY,GAAc,MAAVJ,EAAgB,MAAO,GAAI,IAA2DxP,EAAKsP,EAA5DD,EAAS,GAAQQ,EAAaxQ,OAAOuI,KAAK4H,GAAqB,IAAKF,EAAI,EAAGA,EAAIO,EAAW/O,OAAQwO,IAAOtP,EAAM6P,EAAWP,GAAQM,EAAStB,QAAQtO,IAAQ,IAAaqP,EAAOrP,GAAOwP,EAAOxP,IAAQ,OAAOqP,EAFxM,CAA8BG,EAAQI,GAAuB,GAAIvQ,OAAO0Q,sBAAuB,CAAE,IAAIC,EAAmB3Q,OAAO0Q,sBAAsBP,GAAS,IAAKF,EAAI,EAAGA,EAAIU,EAAiBlP,OAAQwO,IAAOtP,EAAMgQ,EAAiBV,GAAQM,EAAStB,QAAQtO,IAAQ,GAAkBX,OAAOkC,UAAU0O,qBAAqBzO,KAAKgO,EAAQxP,KAAgBqP,EAAOrP,GAAOwP,EAAOxP,IAAU,OAAOqP,EAMne,IAAI,GAAqB,gBAAoB,OAAQ,CACnDa,KAAM,eACNC,EAAG,+yBAGL,SAAS2C,GAAYzC,EAAMC,GACzB,IAAIpH,EAAQmH,EAAKnH,MACbqH,EAAUF,EAAKE,QACfC,EAAQ,GAAyBH,EAAM,CAAC,QAAS,YAErD,OAAoB,gBAAoB,MAAO,GAAS,CACtD,cAAe,OACfI,UAAW,QACX,cAAe,MACf,YAAa,MACb7E,UAAW,gCACX8E,KAAM,MACNC,MAAO,6BACPC,QAAS,cACTC,IAAKP,EACL,kBAAmBC,GAClBC,GAAQtH,EAAqB,gBAAoB,QAAS,CAC3D9D,GAAImL,GACHrH,GAAS,KAAM,IAGpB,IAAI,GAA0B,aAAiB4J,IAChC,ICnCf,SAAS,KAA2Q,OAA9P,GAAWzT,OAAOC,QAAU,SAAU+P,GAAU,IAAK,IAAIC,EAAI,EAAGA,EAAIC,UAAUzO,OAAQwO,IAAK,CAAE,IAAIE,EAASD,UAAUD,GAAI,IAAK,IAAItP,KAAOwP,EAAcnQ,OAAOkC,UAAUkO,eAAejO,KAAKgO,EAAQxP,KAAQqP,EAAOrP,GAAOwP,EAAOxP,IAAY,OAAOqP,IAA2BK,MAAMjO,KAAM8N,WAEhT,SAAS,GAAyBC,EAAQI,GAAY,GAAc,MAAVJ,EAAgB,MAAO,GAAI,IAAkExP,EAAKsP,EAAnED,EAEzF,SAAuCG,EAAQI,GAAY,GAAc,MAAVJ,EAAgB,MAAO,GAAI,IAA2DxP,EAAKsP,EAA5DD,EAAS,GAAQQ,EAAaxQ,OAAOuI,KAAK4H,GAAqB,IAAKF,EAAI,EAAGA,EAAIO,EAAW/O,OAAQwO,IAAOtP,EAAM6P,EAAWP,GAAQM,EAAStB,QAAQtO,IAAQ,IAAaqP,EAAOrP,GAAOwP,EAAOxP,IAAQ,OAAOqP,EAFxM,CAA8BG,EAAQI,GAAuB,GAAIvQ,OAAO0Q,sBAAuB,CAAE,IAAIC,EAAmB3Q,OAAO0Q,sBAAsBP,GAAS,IAAKF,EAAI,EAAGA,EAAIU,EAAiBlP,OAAQwO,IAAOtP,EAAMgQ,EAAiBV,GAAQM,EAAStB,QAAQtO,IAAQ,GAAkBX,OAAOkC,UAAU0O,qBAAqBzO,KAAKgO,EAAQxP,KAAgBqP,EAAOrP,GAAOwP,EAAOxP,IAAU,OAAOqP,EAMne,IAAI,GAAqB,gBAAoB,OAAQ,CACnDa,KAAM,eACNC,EAAG,iMAGL,SAAS4C,GAAkB1C,EAAMC,GAC/B,IAAIpH,EAAQmH,EAAKnH,MACbqH,EAAUF,EAAKE,QACfC,EAAQ,GAAyBH,EAAM,CAAC,QAAS,YAErD,OAAoB,gBAAoB,MAAO,GAAS,CACtD,cAAe,OACfI,UAAW,QACX,cAAe,MACf,YAAa,aACb7E,UAAW,sCACX8E,KAAM,MACNC,MAAO,6BACPC,QAAS,cACTC,IAAKP,EACL,kBAAmBC,GAClBC,GAAQtH,EAAqB,gBAAoB,QAAS,CAC3D9D,GAAImL,GACHrH,GAAS,KAAM,IAGpB,IAAI,GAA0B,aAAiB6J,I,IAChC,I,kBCNAC,GAfM,SAAC,GAGI,EAFtBlE,UAEuB,IADvB5F,EACsB,EADtBA,MAEM+J,EAAUC,cACVC,EAASpT,uBAAY,kBAAMkT,EAAQE,WAAU,CAACF,IACpD,OACI,sBAAKrH,UAAWE,KAAOhJ,UAAvB,UACI,cAAC,GAAD,CAAWoJ,QAASiH,IACpB,qBAAKvH,UAAWE,KAAO5C,MAAvB,SAA+BA,IAC/B,cAAC,GAAD,QCHNkK,GAAQxT,OAAOyT,iBAkGrB,IAkHeC,GAlHA,WAAO,IACVlO,EAAOmO,cAAPnO,GAEAuE,EAAY5B,KAAZ4B,QAHS,EASbC,KAJAE,EALa,EAKbA,aACAO,EANa,EAMbA,2BACAE,EAPa,EAObA,yBACAJ,EARa,EAQbA,wBARa,EAU0B1L,IAAnCI,EAVS,EAUTA,SAAUwB,EAVD,EAUCA,qBAVD,EAYezB,qBAZf,mBAYVoK,EAZU,KAYAwK,EAZA,OAaiB5U,mBAAmB,IAbpC,mBAaV6U,EAbU,KAaCC,EAbD,OAce9U,mBAAmB,IAdlC,mBAcVmQ,EAdU,KAcA4E,EAdA,OAgBb/U,mBAAoB,CAAEqL,iBAAkB,EAAGC,qBAAsB,IAhBpD,0BAeRD,EAfQ,EAeRA,iBAAkBC,EAfV,EAeUA,qBAAwB0J,EAflC,KAkBjB7U,qBAAU,WACN4K,EAAQvE,GAAIyO,MAAK,YAAsB,IAAnBxK,EAAkB,EAAlBA,KAAMhF,EAAY,EAAZA,MACtBuP,EAAY9J,EAAa1E,IACzBoO,EAAYnK,GACZqK,EAAarP,GACbsP,EAAYtP,EAAM8B,KAAK,KAAKJ,MAAM,WAEvC,CAACX,IAzBa,MA2BexG,oBAAS,GA3BxB,mBA2BVkQ,EA3BU,KA2BCgF,EA3BD,OAhGrB,SAA0BC,GACtB,IAAMC,GAAM,IAAIC,MAAOC,UADsB,EAEftV,oBAAS,GAFM,mBAEtCuV,EAFsC,KAE7BC,EAF6B,OAIpBxV,mBAASoV,GAAzBK,EAJoC,sBAKLzV,mBAASwU,IALJ,mBAKtCkB,EALsC,KAKxBC,EALwB,KAOvCC,EAAYzU,uBAAY,kBAAMoU,IAAS,CAACA,IACxCM,EAAY1U,uBAAY,kBAAOyU,MAAa,CAACA,IAE7CE,EAAQ3U,uBAAY,WACtB,IAAM4U,GAAc,IAAIV,MAAOC,UACzBU,EAAkBb,EAAQc,MAC1BxJ,KAAKyJ,IAAIH,EAAaA,GACtBvB,GACNmB,EAAgBK,GAChBR,GAAW,KACZ,CAACL,EAAQc,QAENE,EAAOhV,uBAAY,WACrBwU,EAAgBnB,IAChBgB,GAAW,KACZ,IAoEH,OAlEArV,qBAAU,WACN,IAAIiW,EAGJ,GAAIjB,EAAQc,QAAUJ,IAAa,CAE/B,IAAMQ,EAAe5J,KAAKyJ,IACtB,EACAzJ,KAAKkD,OAAOyF,EAAMM,GAAgBP,EAAQc,QAM9C,GAAII,EAAe,IAAM,EAErB,GAAIjB,GAAOM,EAAc,CACrB,IAAIY,EAAY,EAEhB,GAAgC,oBAArBnB,EAAQoB,SACf,IACID,EAAYnB,EAAQoB,YAAc,EACpC,MAAO/C,GACL7I,QAAQ6L,MAAMhD,GAItB,IAAMiD,EAAqBJ,EAAelB,EAAQc,MAC5CS,EAAcjK,KAAKyJ,IACrBd,EACAM,EACIP,EAAQc,MACRQ,EACAH,GAERX,EAAgBe,GAEhBN,EAAUO,YAAW,WAEjBlB,GAAa,IAAIJ,MAAOC,aACzB7I,KAAKyJ,IAAIQ,GAAc,IAAIrB,MAAOC,UAAW,SAG3CI,EAAelB,KACpB4B,EAAUO,YAAW,WAEjBlB,GAAa,IAAIJ,MAAOC,aAEzB7I,KAAKyJ,IAAIR,GAAe,IAAIL,MAAOC,UAAW,UAOrDc,EAAUO,YAAW,WACjBlB,GAAa,IAAIJ,MAAOC,aACzB,IAIX,OAAO,WACHsB,aAAaR,MAElB,CAAChB,EAAKM,EAAcG,EAAWV,EAAQc,MAAOd,IAE1C,CACHW,QACAK,QAiCoBU,CAAiB,CACrCZ,MAAQ,GAAKhW,EAASP,eAAkB,IACxC6W,SAAU,WACN,IAAM/K,EAAeC,EAA2BjF,EAAI,GAKpD,OAJAwO,GAAY,SAAC8B,GAAD,mBAAC,eACNA,GADK,IAERzL,iBAAkBG,OAEmC,GAAlDiB,KAAKyJ,IAAI,EAAG/F,EAAS3E,GAActJ,OAAS,OARnD4T,EA7BS,EA6BTA,MAAOK,EA7BE,EA6BFA,KAYThD,EAAahS,uBACf,kBACI+T,GAAW,SAACtM,GACR,IAAIpH,GAAYoH,EAMhB,OALIpH,EACAsU,IAEAK,IAEG3U,OAEf,CAACsU,EAAOK,IAGNjD,EAAU/R,uBACZ,kBAAMM,EAAqB,MAC3B,CAACA,IAECwR,EAAY9R,uBACd,kBAAMM,GAAsB,MAC5B,CAACA,IAGC2O,EAAgBjP,uBAAY,WAC9BgS,MACD,CAACA,IAEE5F,EAAkBpM,uBACpB,SAAC4L,GACG,IAAMvB,EACFqJ,EAAUlN,MAAM,EAAGoF,GAAOxF,KAAK,KAAKJ,MAAM,KAAKjF,OAAS,EAC5D8S,GAAY,SAAC8B,GAAD,mBAAC,eACNA,GADK,IAERxL,qBAAsByB,EACtB1B,iBAAkBG,OAEtBG,EAAyBnF,EAAIuG,GAC7BxB,EAAwB/E,EAAIgF,KAEhC,CAACG,EAA0BkJ,EAAWrO,IAG1C,OACI,sBAAKwG,UAAWE,KAAOhJ,UAAvB,UACI,cAAC,GAAD,CAAcgM,UAAWA,EAAW5F,OAAe,OAARF,QAAQ,IAARA,OAAA,EAAAA,EAAUE,QAAS,MAC5D4F,GACE,cAAC,GAAD,CACI1C,UAAWqH,EACXxH,aAAc/B,EACdiC,gBAAiBA,IAGxB2C,GACG,cAAC,GAAD,CACIA,UAAWA,EACXC,SAAUA,EACV9E,iBAAkBA,EAClB+E,cAAeA,IAGvB,cAAC,GAAD,CACIF,UAAWA,EACX7C,aAAchC,EACd4H,UAAWA,EACXC,QAASA,EACTC,WAAYA,EACZC,WAAYyB,EAAU3S,OACtBxC,eAAgBO,EAASP,qB,oBCnK1BqX,OA/Cf,YAAqD,IAAD,EAApC7M,EAAoC,EAApCA,KAAM6J,EAA8B,EAA9BA,MAEZiD,GAF0C,EAAvB1J,QAEN2J,iBAAuB,OAK1C,OAHkB7E,GAAe,KAAM,KAC3BG,GAAW,KAAM,IAAM,KACnC5H,QAAQC,IAAIV,GAER,eAAC,IAAD,CAAMgN,GAAE,gBAAWhN,EAAK1D,IAAMwG,UAAWE,KAAOhJ,UAAhD,UACI,qBACI8I,UAAWC,KAAGC,KAAOhD,KAAMgD,KAAOiK,SAArB,mBACRjK,KAAOiK,SAAWjN,EAAKrE,OADf,cAERqH,KAAOiK,QAAUjN,EAAKrE,OAFd,IADjB,UAWMqE,EAAKrE,QAAUqE,EAAKrE,QAClB,sBAAKoM,IAAK+E,EAAYhK,UAAWE,KAAOkK,YAAxC,UACI,8BACI,+BAAeC,EAAE,IAAIC,EAAE,IAAI1I,MAAM,OAAOT,OAAO,OAA/C,SACI,qBAAKnB,UAAWE,KAAO5C,MAAvB,SAA+BJ,EAAKI,YAG5C,8BACI,+BAAe+M,EAAE,IAAIC,EAAE,MAAM1I,MAAM,OAAOT,OAAO,OAAjD,SACI,qBAAKnB,UAAWE,KAAOqK,OAAvB,SAAgCrN,EAAKK,mBAMzD,sBAAKyC,UAAWE,KAAO+G,OAAvB,UACI,8BACyB,QAApBF,EAAMV,UAAN,UACQU,EAAMV,UADd,MAEK,aAEV,8BAAMU,EAAMxB,oB,oBCvCbiF,OAjBf,SAAsBrC,EAAcoB,GAchC,OAbiBpV,uBAAY,WACzB,IAAMsW,EAAQvL,SAASC,cAAc,SACrCsL,EAAMxQ,KAAO,OACbwQ,EAAMC,UAAW,EACjBD,EAAME,SAAW,SAACC,GACd,IAAKA,EAAMnH,QAAiD,IAAtCmH,EAAMnH,OAAexN,MAAMf,OAC7C,OAAOqU,EAAS,IAEpBA,EAAUqB,EAAMnH,OAAexN,QAEnCwU,EAAMI,UACP,CAACtB,KCyCOuB,GA5CC,WAAO,IAAD,EACa3O,KAAvBI,EADU,EACVA,QAASO,EADC,EACDA,UAGXiO,GAFmB/M,KAAjBE,aAEMsM,GAAa,CAAEE,UAAU,GAAb,uCAAqB,WAAOzU,GAAP,SAAAQ,EAAA,yDACtB,IAAjBR,EAAMf,OADiC,iEAIrC4H,EAAU7G,GAJ2B,2CAArB,wDAOpB+U,EAAc7W,uBAAY,SAACqF,MAAmB,IAEpD,OACI,sBAAKwG,UAAWE,KAAOhJ,UAAvB,UACI,sBAAK8I,UAAWE,KAAO+K,OAAvB,UACI,qBAAKjL,UAAWE,KAAO5C,MAAvB,qBACA,qBAAK0C,UAAWE,KAAOgL,IAAK5K,QAASyK,EAArC,SACI,cAAC,GAAD,SAGR,qBAAK/K,UAAWE,KAAOiL,cAAvB,SACI,qBAAKnL,UAAWE,KAAOoC,KAAvB,SACK/F,EAAQ9G,KAAI,SAACyH,GAAD,OACT,cAAC,GAAD,CAEIA,KAAMA,EACN6J,MAAO,CACHV,UAAW,MACXd,WAAY,KAEhBjF,QAAS0K,GANJ9N,EAAK1D,WAW1B,sBAAKwG,UAAWE,KAAOkL,WAAvB,UACI,0CACA,kD,MC7BDC,OAXf,WACE,OACE,cAAC,GAAD,UACE,eAAC,IAAD,WACE,cAAC,IAAD,CAAOjR,KAAK,YAAYkR,UAAW5D,KACnC,cAAC,IAAD,CAAOtN,KAAK,IAAIkR,UAAWR,WCApBS,GAZS,SAACC,GACnBA,GAAeA,aAAuB9V,UACxC,6BAAqBuS,MAAK,YAAkD,IAA/CwD,EAA8C,EAA9CA,OAAQC,EAAsC,EAAtCA,OAAQC,EAA8B,EAA9BA,OAAQC,EAAsB,EAAtBA,OAAQC,EAAc,EAAdA,QAC3DJ,EAAOD,GACPE,EAAOF,GACPG,EAAOH,GACPI,EAAOJ,GACPK,EAAQL,OCHdM,IAASC,OACP,cAAC,IAAMC,WAAP,UACE,cAAC,GAAD,MAEF9M,SAAS+M,eAAe,SAM1BV,O","file":"static/js/main.6ae39a36.chunk.js","sourcesContent":["// extracted by mini-css-extract-plugin\nmodule.exports = {\"container\":\"styles_container__xRGQ3\",\"topLine\":\"styles_topLine__9Xzw9\",\"controls\":\"styles_controls__aw6aK\",\"button\":\"styles_button__1pqxT\",\"wordsPerMinute\":\"styles_wordsPerMinute__2rsVl\",\"stats\":\"styles_stats__2RUm0\",\"bar\":\"styles_bar__xDlIR\",\"bottom\":\"styles_bottom__1djMp\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"container\":\"styles_container__3L1DU\",\"book\":\"styles_book__3kr_u\",\"cover\":\"styles_cover__6Uu98\",\"nocover\":\"styles_nocover__2Rzyk\",\"bookWrapper\":\"styles_bookWrapper__385Le\",\"title\":\"styles_title__2fozK\",\"author\":\"styles_author__1rUEC\",\"bottom\":\"styles_bottom__3ye7t\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"container\":\"styles_container__HUCkD\",\"header\":\"styles_header__3miEM\",\"title\":\"styles_title__1elQZ\",\"add\":\"styles_add__h5c36\",\"listContainer\":\"styles_listContainer__26jV9\",\"list\":\"styles_list__1Gvkp\",\"bottomMenu\":\"styles_bottomMenu__2YYEk\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"container\":\"styles_container__1BmkX\",\"b\":\"styles_b__1Qifu\",\"list\":\"styles_list__1RbfW\",\"sentenceRow\":\"styles_sentenceRow__1tuBL\",\"selected\":\"styles_selected__3yVPV\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"container\":\"styles_container__1qrsw\",\"textPlayer\":\"styles_textPlayer__39i09\",\"text\":\"styles_text__1rirC\",\"selected\":\"styles_selected__305tA\",\"playing\":\"styles_playing__DnXTA\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"container\":\"styles_container__PILz8\",\"title\":\"styles_title__3qgYC\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"container\":\"styles_container__3TSyu\"};","\r\nimport { createContext, useContext } from \"react\";\r\n\r\nexport default function createCtx<A extends {} | null>() {\r\n    const ctx = createContext<A | undefined>(undefined);\r\n    function useCtx() {\r\n        const c = useContext(ctx);\r\n        if (c === undefined) {\r\n            throw new Error('useCtx must be inside a Provider with a value');\r\n        }\r\n        return c;\r\n    }\r\n    return [useCtx, ctx.Provider] as const;\r\n}","import createCtx from '../../utils/context';\r\nimport { useCallback, useEffect, useState } from 'react';\r\n\r\ninterface ISettingsProviderProps {\r\n    children: React.ReactNode;\r\n}\r\n\r\ninterface ISettingsContext {\r\n    settings: ISettings;\r\n\r\n    setWordsPerMinute: (newValue: number) => void;\r\n    updateWordsPerMinute: (incValue: number) => void;\r\n\r\n    setFont: (newValue: string) => void;\r\n    setFontSize: (newValue: number) => void;\r\n    setUseORP: (newValue: boolean) => void;\r\n    setSlowDownOnLongWords: (newValue: boolean) => void;\r\n}\r\n\r\nexport interface ISettings {\r\n    font: string;\r\n    fontSize: number;\r\n    wordsPerMinute: number;\r\n    useORP: boolean;\r\n    slowDownOnLongWords: boolean;\r\n}\r\n\r\nconst defaultSettings = {\r\n    font: 'Kazemir',\r\n    fontSize: 16,\r\n    wordsPerMinute: 320,\r\n    useORP: true,\r\n    slowDownOnLongWords: true,\r\n};\r\n\r\nconst [useSettingsContext, Provider] = createCtx<ISettingsContext>();\r\n\r\nconst SettingsProvider = ({ children }: ISettingsProviderProps) => {\r\n    const [settings, setSettings] = useState<ISettings | null>(null);\r\n\r\n    useEffect(() => {\r\n        const settings: Partial<ISettings> = {};\r\n\r\n        const {\r\n            wordsPerMinute: defaultWordsPerMinute,\r\n            ...defaultSettingsRest\r\n        } = defaultSettings;\r\n\r\n        const settingsString = localStorage.getItem('settings');\r\n        if (!settingsString) {\r\n            localStorage.setItem(\r\n                'settings',\r\n                JSON.stringify(defaultSettingsRest)\r\n            );\r\n            Object.assign(settings, defaultSettingsRest);\r\n        } else {\r\n            Object.assign(settings, JSON.parse(settingsString));\r\n        }\r\n\r\n        const wordsPerMinuteString = localStorage.getItem('wordsPerMinute');\r\n        if (!wordsPerMinuteString) {\r\n            localStorage.setItem(\r\n                'wordsPerMinute',\r\n                String(defaultWordsPerMinute)\r\n            );\r\n            settings.wordsPerMinute = defaultWordsPerMinute;\r\n        } else {\r\n            settings.wordsPerMinute = Number(wordsPerMinuteString);\r\n        }\r\n\r\n        setSettings(settings as ISettings);\r\n    }, []);\r\n\r\n    const setSetting = useCallback(\r\n        <K extends keyof ISettings>(key: K, value: ISettings[K]) => {\r\n            setSettings((currentSettings) => {\r\n                if (!currentSettings) {\r\n                    return null;\r\n                }\r\n                if (key === 'wordsPerMinute') {\r\n                    localStorage.setItem('wordsPerMinute', String(value));\r\n                } else {\r\n                    localStorage.setItem(\r\n                        'settings',\r\n                        JSON.stringify({ ...currentSettings, [key]: value })\r\n                    );\r\n                }\r\n                return { ...currentSettings, [key]: value };\r\n            });\r\n        },\r\n        []\r\n    );\r\n\r\n    const setWordsPerMinute = useCallback(\r\n        (newValue: number) => setSetting('wordsPerMinute', newValue),\r\n        [setSetting]\r\n    );\r\n    const updateWordsPerMinute = useCallback(\r\n        (incValue: number) =>\r\n            setSetting(\r\n                'wordsPerMinute',\r\n                (settings?.wordsPerMinute || defaultSettings.wordsPerMinute) +\r\n                    incValue\r\n            ),\r\n        [settings?.wordsPerMinute, setSetting]\r\n    );\r\n\r\n    const setFont = useCallback(\r\n        (newValue: string) => setSetting('font', newValue),\r\n        [setSetting]\r\n    );\r\n    const setFontSize = useCallback(\r\n        (newValue: number) => setSetting('fontSize', newValue),\r\n        [setSetting]\r\n    );\r\n    const setUseORP = useCallback(\r\n        (newValue: boolean) => setSetting('useORP', newValue),\r\n        [setSetting]\r\n    );\r\n    const setSlowDownOnLongWords = useCallback(\r\n        (newValue: boolean) => setSetting('slowDownOnLongWords', newValue),\r\n        [setSetting]\r\n    );\r\n\r\n    if (!settings) {\r\n        return null;\r\n    }\r\n\r\n    return (\r\n        <Provider\r\n            value={{\r\n                settings,\r\n                setWordsPerMinute,\r\n                updateWordsPerMinute,\r\n                setFont,\r\n                setFontSize,\r\n                setUseORP,\r\n                setSlowDownOnLongWords,\r\n            }}\r\n        >\r\n            {children}\r\n        </Provider>\r\n    );\r\n};\r\n\r\nexport { useSettingsContext };\r\n\r\nexport default SettingsProvider;\r\n","\r\ninterface ISentenceTokenizer {\r\n  (): void;\r\n  trim: (array: string[]) => string[];\r\n  tokenize: (text: string) => string[];\r\n}\r\n\r\nconst SentenceTokenizer = function () {\r\n}\r\n\r\nSentenceTokenizer.trim = function (array: string[]) {\r\n    while (array[array.length - 1] === '') { array.pop() }\r\n    while (array[0] === '') { array.shift() }  \r\n    return array;\r\n}\r\n\r\nSentenceTokenizer.tokenize = function (text: string): string[] {\r\n    // break string up in to sentences based on punctation and quotation marks\r\n    let tokens = text.match(/(?<=\\s+|^)[\"'‘“'\"[({⟨]?(.*?[.?!])(\\s[.?!])*[\"'’”'\"\\])}⟩]?(?=\\s+|$)|(?<=\\s+|^)\\S(.*?[.?!])(\\s[.?!])*(?=\\s+|$)/g);\r\n\r\n    if (!tokens) {\r\n      return [text]\r\n    }\r\n\r\n    // remove unecessary white space\r\n    tokens = tokens.map(Function.prototype.call, String.prototype.trim);\r\n\r\n    return this.trim(tokens);\r\n}\r\n\r\nexport default SentenceTokenizer as ISentenceTokenizer;","import JsZip from 'jszip';\r\nimport parser from 'fast-xml-parser';\r\nimport mime from 'mime-types';\r\nimport SentenceTokenizer from './SentenceTokenizer';\r\n\r\ntype PickByValue<T, V> = Pick<\r\n    T,\r\n    { [K in keyof T]: T[K] extends V ? K : never }[keyof T]\r\n>;\r\ntype Entries<T> = {\r\n    [K in keyof T]: [keyof PickByValue<T, T[K]>, T[K]];\r\n}[keyof T][];\r\n\r\ntype TEpubXMLIdentifier = {\r\n    value: string;\r\n    attr: {\r\n        id: string;\r\n    };\r\n};\r\n\r\ninterface IEpubXMLMetadata {\r\n    identifier: TEpubXMLIdentifier | TEpubXMLIdentifier[];\r\n    title: string;\r\n    language: string;\r\n    creator?: string;\r\n\r\n    description?: string;\r\n    subject?: string;\r\n    publisher?: string;\r\n\r\n    date?: string | number;\r\n\r\n    meta: Array<{ attr: { name: string; content: string | number } }>;\r\n}\r\n\r\ninterface IEpubXMLManifest {\r\n    item: Array<{ attr: { href: string; 'media-type': string; id: string } }>;\r\n}\r\n\r\ninterface IEpubXMLSpineItemRef {\r\n    attr: {\r\n        id?: string;\r\n        idref: string;\r\n        linear?: 'yes' | 'no';\r\n    };\r\n}\r\n\r\ninterface IEpubXMLSpine {\r\n    attr: {\r\n        id?: string;\r\n        'page-progression-direction'?: 'rtl' | 'ltr';\r\n        toc?: string;\r\n    };\r\n    itemref: IEpubXMLSpineItemRef | IEpubXMLSpineItemRef[];\r\n}\r\n\r\ninterface IXMLData {\r\n    package: {\r\n        attr: {\r\n            version: number;\r\n            'unique-identifier': string;\r\n        };\r\n        metadata: IEpubXMLMetadata;\r\n        manifest: IEpubXMLManifest;\r\n        spine: IEpubXMLSpine;\r\n        guide?:\r\n            | string\r\n            | {\r\n                  reference: {\r\n                      attr: {\r\n                          href: string;\r\n                          type: string;\r\n                          title: string;\r\n                      };\r\n                  };\r\n              };\r\n    };\r\n}\r\n\r\ninterface IEpubMetadata {\r\n    identifier: string;\r\n    publisher?: string;\r\n    language?: string;\r\n    title?: string;\r\n    subject?: string;\r\n    description?: string;\r\n    creator?: string;\r\n    date?: string;\r\n}\r\n\r\ninterface IEpubSpine {\r\n    id?: string;\r\n    direction?: 'rtl' | 'ltr';\r\n    toc?: string;\r\n    items: Array<string>;\r\n}\r\n\r\ntype TEpubManifest = {\r\n    href: string;\r\n    'media-type': string;\r\n    id: string;\r\n}[];\r\n\r\ntype TEpubGuide = {\r\n    href: string;\r\n    type: string;\r\n    title: string;\r\n};\r\n\r\nfunction findFile(archive: JsZip, filename: string) {\r\n    if (archive.files[filename]) {\r\n        return archive.files[filename];\r\n    }\r\n    const result = archive.filter(\r\n        (_, file) => file.name.toLowerCase() === filename.toLowerCase()\r\n    );\r\n    if (result.length > 0) {\r\n        return result[0];\r\n    }\r\n    return null;\r\n}\r\n\r\nasync function validateMimeType(archive: JsZip) {\r\n    const mimeFile = findFile(archive, 'mimetype');\r\n    if (!mimeFile) {\r\n        throw new Error('No mimetype file in archive');\r\n    }\r\n\r\n    const epubMimeType = await mimeFile.async('text');\r\n\r\n    if (epubMimeType.toLowerCase().trim() !== 'application/epub+zip') {\r\n        throw new Error('Unsupported mime type');\r\n    }\r\n}\r\n\r\nasync function validateRootFile(archive: JsZip) {\r\n    const containerFile = findFile(archive, 'meta-inf/container.xml');\r\n    if (!containerFile) {\r\n        throw new Error('No container file in archive');\r\n    }\r\n\r\n    const xmlData = await containerFile.async('text');\r\n    const parsedXML = parser.parse(xmlData, { ignoreAttributes: false });\r\n\r\n    if (\r\n        !parsedXML.container.rootfiles ||\r\n        !parsedXML.container.rootfiles.rootfile\r\n    ) {\r\n        throw new Error('No rootfiles found');\r\n    }\r\n\r\n    const rootFileInfo = parsedXML.container.rootfiles.rootfile;\r\n    let filename: string;\r\n\r\n    if (rootFileInfo['@_media-type'] !== 'application/oebps-package+xml') {\r\n        throw new Error('Rootfile in unknown format');\r\n    }\r\n\r\n    filename = rootFileInfo['@_full-path'];\r\n\r\n    if (!filename) {\r\n        throw new Error('Empty rootfile');\r\n    }\r\n\r\n    const rootFile = findFile(archive, filename);\r\n    if (!rootFile) {\r\n        throw new Error('Rootfile not found from archive');\r\n    }\r\n\r\n    return rootFile;\r\n}\r\n\r\nasync function parseRootFile(archive: JsZip, rootFile: JsZip.JSZipObject) {\r\n    const text = await rootFile.async('text');\r\n    const XMLData = parser.parse(text, {\r\n        attributeNamePrefix: '',\r\n        attrNodeName: 'attr',\r\n        textNodeName: 'value',\r\n        ignoreAttributes: false,\r\n        ignoreNameSpace: true,\r\n        parseAttributeValue: true,\r\n    }) as IXMLData;\r\n\r\n    const metadata = parseMetadata(XMLData);\r\n    const spine = parseSpine(XMLData);\r\n    const manifest = parseManifest(XMLData);\r\n    const guide = parseGuide(XMLData);\r\n\r\n    const processingItems = processItems(manifest, spine);\r\n    const items = await loadItems(archive, rootFile, processingItems);\r\n\r\n    const foundCover = findCover(manifest, guide);\r\n    const cover = await loadCover(archive, rootFile, foundCover);\r\n\r\n    return {\r\n        cover,\r\n        metadata,\r\n        items,\r\n    };\r\n}\r\n\r\nfunction parseMetadata(XMLData: IXMLData) {\r\n    const metadata: Partial<IEpubMetadata> = {};\r\n\r\n    const uidName = XMLData.package.attr['unique-identifier'];\r\n    const entries = Object.entries(\r\n        XMLData.package.metadata\r\n    ) as Entries<IEpubXMLMetadata>;\r\n    for (const entry of entries) {\r\n        if (entry) {\r\n            const [key, value] = entry;\r\n\r\n            if (value) {\r\n                let parsedValue = null;\r\n                if (key === 'identifier') {\r\n                    parsedValue = value;\r\n                    if (Array.isArray(value)) {\r\n                        parsedValue = (value as TEpubXMLIdentifier[]).find(\r\n                            (item) => item.attr.id === uidName\r\n                        );\r\n                        if (parsedValue) {\r\n                            parsedValue = parsedValue.value;\r\n                        }\r\n                    } else {\r\n                        parsedValue = (value as TEpubXMLIdentifier).value;\r\n                    }\r\n                    if (parsedValue) {\r\n                        parsedValue = String(parsedValue)\r\n                            .replace('urn:uuid:', '')\r\n                            .toUpperCase()\r\n                            .trim();\r\n                    } else {\r\n                        throw new Error(\r\n                            'Cannot determine book unique identifier'\r\n                        );\r\n                    }\r\n                } else {\r\n                    if (typeof value === 'object') {\r\n                        // TODO: Do better typings\r\n                        parsedValue = (value as any).value;\r\n                    } else {\r\n                        parsedValue = value;\r\n                    }\r\n                }\r\n                metadata[key as keyof IEpubMetadata] = parsedValue;\r\n            }\r\n        }\r\n    }\r\n\r\n    return metadata as IEpubMetadata;\r\n}\r\n\r\nfunction parseSpine(XMLData: IXMLData) {\r\n    const spine: Partial<IEpubSpine> = {\r\n        items: [],\r\n    };\r\n    if ('id' in XMLData.package.spine.attr) {\r\n        spine.id = XMLData.package.spine.attr.id;\r\n    }\r\n    if ('page-progression-direction' in XMLData.package.spine.attr) {\r\n        spine.direction =\r\n            XMLData.package.spine.attr['page-progression-direction'];\r\n    }\r\n    if ('toc' in XMLData.package.spine.attr) {\r\n        spine.toc = XMLData.package.spine.attr.toc;\r\n    }\r\n\r\n    if (Array.isArray(XMLData.package.spine.itemref)) {\r\n        for (const item of XMLData.package.spine.itemref) {\r\n            spine.items?.push(item.attr.idref);\r\n        }\r\n    } else {\r\n        spine.items?.push(XMLData.package.spine.itemref.attr.idref);\r\n    }\r\n\r\n    return spine as IEpubSpine;\r\n}\r\n\r\nfunction parseManifest(XMLData: IXMLData) {\r\n    const manifest: TEpubManifest = [];\r\n    for (const item of XMLData.package.manifest.item) {\r\n        manifest.push(item.attr);\r\n    }\r\n    return manifest;\r\n}\r\n\r\nfunction parseGuide(XMLData: IXMLData) {\r\n    if (!XMLData.package.guide || typeof XMLData.package.guide === 'string') {\r\n        return undefined;\r\n    }\r\n    // There is books where guide is array;\r\n    return XMLData.package.guide.reference.attr;\r\n}\r\n\r\n//\r\n\r\nfunction findCover(manifest: TEpubManifest, guide?: TEpubGuide) {\r\n    if (guide && guide.type === 'cover') {\r\n        return guide;\r\n    }\r\n    for (const item of manifest) {\r\n        if (item.id.includes('cover.jpg')) {\r\n            return item;\r\n        }\r\n    }\r\n}\r\nfunction processItems(manifest: TEpubManifest, spine: IEpubSpine) {\r\n    const items = [];\r\n    for (const id of spine.items) {\r\n        const item = manifest.find((item) => item.id === id);\r\n        if (item && item['media-type'] === 'application/xhtml+xml') {\r\n            items.push(item);\r\n        }\r\n    }\r\n    return items;\r\n}\r\n\r\n//\r\n\r\nasync function loadCover(\r\n    archive: JsZip,\r\n    rootFile: JsZip.JSZipObject,\r\n    cover?: { href: string; 'media-type'?: string }\r\n) {\r\n    if (!cover) {\r\n        return null;\r\n    }\r\n\r\n    const [path, _] = rootFile?.name.split('/');\r\n    const filePath = [path, cover.href].join('/');\r\n    const blob = await archive.files[filePath].async('blob');\r\n\r\n    const type = cover['media-type'] || mime.lookup(cover.href);\r\n\r\n    if (!type) {\r\n        return blob;\r\n    }\r\n\r\n    return blob.slice(0, blob.size, type);\r\n}\r\n\r\nasync function loadItems(\r\n    archive: JsZip,\r\n    rootFile: JsZip.JSZipObject,\r\n    processingItems: Array<{ href: string }>\r\n) {\r\n    const [path, _] = rootFile?.name.split('/');\r\n\r\n    const loadingItems = [];\r\n    for (const { href } of processingItems) {\r\n        const filePath = [path, href].join('/');\r\n        loadingItems.push(archive.files[filePath].async('text'));\r\n    }\r\n    const domParser = new DOMParser();\r\n    const loadedItems = await Promise.all(loadingItems);\r\n    const parsedItems = loadedItems\r\n        .map((item) =>\r\n            SentenceTokenizer.tokenize(\r\n                (\r\n                    domParser\r\n                        .parseFromString(item, 'application/xhtml+xml')\r\n                        .body.textContent?.trimStart()\r\n                        ?.trimEnd() + '.'\r\n                )\r\n                    .split('\\n')\r\n                    .join('. ')\r\n            )\r\n                .map((item) => item.replaceAll('. .', '.'))\r\n                .filter((item) => item !== '.')\r\n        )\r\n        .reduce((acc, v) => [...acc, ...v], []);\r\n    return parsedItems;\r\n}\r\n\r\nasync function epubToTxt(blob: Blob) {\r\n    if (blob.type !== 'application/epub+zip') {\r\n        throw new Error('Not an Epub file');\r\n    }\r\n\r\n    const zip = new JsZip();\r\n    const archive = await zip.loadAsync(blob);\r\n\r\n    if (Object.keys(archive.files).length === 0) {\r\n        throw new Error('No files in archive');\r\n    }\r\n\r\n    await validateMimeType(archive);\r\n    const rootFile = await validateRootFile(archive);\r\n    const parsedEpub = await parseRootFile(archive, rootFile);\r\n\r\n    return parsedEpub;\r\n}\r\n\r\nexport default epubToTxt;\r\n","import createCtx from '../../utils/context';\r\nimport localforage from 'localforage';\r\nimport { useCallback, useEffect, useState } from 'react';\r\nimport epubToTxt from '../../Libraries/epubToTxt';\r\n\r\ninterface ILibraryProviderProps {\r\n    children: React.ReactNode;\r\n}\r\n\r\ninterface ILibraryRecord {\r\n    id: string;\r\n    title: string;\r\n    creator?: string;\r\n    cover: boolean;\r\n\r\n    totalWords: number;\r\n    totalSentences: number;\r\n}\r\n\r\nexport interface IBookInfo {\r\n    id: string;\r\n    title: string;\r\n    creator?: string;\r\n    cover: string | boolean;\r\n\r\n    totalWords: number;\r\n    totalSentences: number;\r\n}\r\n\r\ninterface ILibraryContext {\r\n    library: IBookInfo[];\r\n\r\n    loadBooks: (files: Blob[]) => void;\r\n    deleteBook: (id: string) => void;\r\n\r\n    getBook: (id: string) => Promise<{\r\n        info: IBookInfo;\r\n        items: string[];\r\n    }>;\r\n}\r\n\r\nconst [useLibraryContext, Provider] = createCtx<ILibraryContext>();\r\n\r\nconst LibraryProvider = ({ children }: ILibraryProviderProps) => {\r\n    const [isLoading, setIsLoading] = useState(false);\r\n    const [library, setLibrary] = useState<IBookInfo[]>([]);\r\n\r\n    useEffect(() => {\r\n        (async () => {\r\n            const data = await localforage.getItem<IBookInfo[]>('library');\r\n            setLibrary((data as any) || []);\r\n\r\n            for (let item of (data || []) as any) {\r\n                const coverBlob = await localforage.getItem(`${item.id}_cover`);\r\n                if (coverBlob) {\r\n                    (item as any).cover = URL.createObjectURL(coverBlob);\r\n                }\r\n            }\r\n            setIsLoading(false);\r\n        })();\r\n    }, []);\r\n\r\n    // const bookExists = useCallback(\r\n    //     (id: string) => {\r\n    //         if (!library) {\r\n    //             return false;\r\n    //         }\r\n    //         return !!library.find((item) => item.id === id);\r\n    //     },\r\n    //     [library]\r\n    // );\r\n\r\n    //\r\n    const loadBooks = useCallback(\r\n        async (files: Blob[]) => {\r\n            const parsedBooks = await Promise.all(\r\n                Array.from(files).map((file) => epubToTxt(file))\r\n            );\r\n\r\n            const loadedBooks = parsedBooks.map((book) => {\r\n                const totalWords = book.items.reduce(\r\n                    (acc, item) => acc + item.split(' ').length,\r\n                    0\r\n                );\r\n\r\n                const bookInfo = {\r\n                    id: book.metadata.identifier,\r\n                    title: book.metadata.title || '',\r\n                    creator: book.metadata.creator || '',\r\n                    cover: !!book.cover,\r\n\r\n                    totalWords,\r\n                    totalSentences: book.items.length,\r\n                };\r\n\r\n                return {\r\n                    id: bookInfo.id,\r\n                    info: bookInfo,\r\n                    items: book.items,\r\n                    cover: book.cover,\r\n                    coverUrl: book.cover\r\n                        ? URL.createObjectURL(book.cover)\r\n                        : false,\r\n                };\r\n            });\r\n\r\n            await Promise.all(\r\n                loadedBooks.map(({ id, items }) =>\r\n                    localforage.setItem(id, items)\r\n                )\r\n            );\r\n\r\n            console.log(loadedBooks);\r\n\r\n            const newLibrary = [\r\n                ...library,\r\n                ...loadedBooks.map(({ info }) => info),\r\n            ];\r\n            await localforage.setItem('library', newLibrary);\r\n\r\n            await Promise.all(\r\n                loadedBooks\r\n                    .filter(({ cover }) => !!cover)\r\n                    .map(({ id, cover }) =>\r\n                        localforage.setItem(`${id}_cover`, cover)\r\n                    )\r\n            );\r\n\r\n            setLibrary([\r\n                ...library,\r\n                ...loadedBooks.map(({ info, coverUrl }) => ({\r\n                    ...info,\r\n                    cover: coverUrl,\r\n                })),\r\n            ]);\r\n        },\r\n        [library]\r\n    );\r\n\r\n    const deleteBook = useCallback((id: string) => {}, []);\r\n\r\n    const getBook = useCallback(\r\n        async (id: string) => {\r\n            const items = (await localforage.getItem<string[]>(id)) || [];\r\n            const info = library!.find((item) => item.id === id)!;\r\n            return {\r\n                info,\r\n                items,\r\n            };\r\n        },\r\n        [library]\r\n    );\r\n\r\n    if (isLoading) {\r\n        return null;\r\n    }\r\n\r\n    return (\r\n        <Provider\r\n            value={{\r\n                library,\r\n\r\n                loadBooks,\r\n                deleteBook,\r\n\r\n                getBook,\r\n            }}\r\n        >\r\n            {children}\r\n        </Provider>\r\n    );\r\n};\r\n\r\nexport { useLibraryContext };\r\n\r\nexport default LibraryProvider;\r\n","import createCtx from '../../utils/context';\r\nimport { useCallback, useEffect, useState } from 'react';\r\n\r\ninterface IReadingStatsProviderProps {\r\n    children: React.ReactNode;\r\n}\r\n\r\ninterface IReadingStatsContext {\r\n    getBookStats: (id: string) => IBookStat;\r\n    setBookCurrentWordIndex: (id: string, newWordIndex: number) => void;\r\n    updateBookCurrentWordIndex: (id: string, incValue: number) => number;\r\n    setBookSentenceWordIndex: (id: string, newSentenceIndex: number) => void;\r\n    updateBookSentenceWordIndex: (id: string, incValue: number) => number;\r\n}\r\n\r\nexport interface IBookStat {\r\n    currentWordIndex: number;\r\n    currentSentenceIndex: number;\r\n}\r\n\r\nconst [useReadingStatsContext, Provider] = createCtx<IReadingStatsContext>();\r\n\r\nconst ReadingStatsProvider = ({ children }: IReadingStatsProviderProps) => {\r\n    const getBookStats = useCallback((id: string) => {\r\n        const savedBookStat = localStorage.getItem(id);\r\n        if (!savedBookStat) {\r\n            const newBookStat = {\r\n                currentWordIndex: 0,\r\n                currentSentenceIndex: 0,\r\n            };\r\n            localStorage.setItem(id, JSON.stringify(newBookStat));\r\n            return newBookStat;\r\n        }\r\n        return JSON.parse(savedBookStat);\r\n    }, []);\r\n\r\n    const setBookCurrentWordIndex = useCallback(\r\n        (id: string, newWordIndex: number) => {\r\n            const savedBookStat = localStorage.getItem(id);\r\n            if (!savedBookStat) {\r\n                return;\r\n            }\r\n            localStorage.setItem(\r\n                id,\r\n                JSON.stringify({\r\n                    ...JSON.parse(savedBookStat),\r\n                    currentWordIndex: newWordIndex,\r\n                })\r\n            );\r\n        },\r\n        []\r\n    );\r\n\r\n    const updateBookCurrentWordIndex = useCallback(\r\n        (id: string, incValue: number) => {\r\n            const savedBookStat = localStorage.getItem(id);\r\n            if (!savedBookStat) {\r\n                return 0;\r\n            }\r\n            const currentBookStat = JSON.parse(savedBookStat);\r\n            const currentWordIndex =\r\n                currentBookStat.currentWordIndex + incValue;\r\n            localStorage.setItem(\r\n                id,\r\n                JSON.stringify({\r\n                    currentBookStat,\r\n                    currentWordIndex,\r\n                })\r\n            );\r\n            return currentWordIndex;\r\n        },\r\n        []\r\n    );\r\n\r\n    const setBookSentenceWordIndex = useCallback(\r\n        (id: string, newSentenceIndex: number) => {\r\n            const savedBookStat = localStorage.getItem(id);\r\n            if (!savedBookStat) {\r\n                return;\r\n            }\r\n            localStorage.setItem(\r\n                id,\r\n                JSON.stringify({\r\n                    ...JSON.parse(savedBookStat),\r\n                    currentSentenceIndex: newSentenceIndex,\r\n                })\r\n            );\r\n        },\r\n        []\r\n    );\r\n\r\n    const updateBookSentenceWordIndex = useCallback(\r\n        (id: string, incValue: number) => {\r\n            const savedBookStat = localStorage.getItem(id);\r\n            if (!savedBookStat) {\r\n                return 0;\r\n            }\r\n            const currentBookStat = JSON.parse(savedBookStat);\r\n            const currentSentenceIndex =\r\n                currentBookStat.currentSentenceIndex + incValue;\r\n            localStorage.setItem(\r\n                id,\r\n                JSON.stringify({\r\n                    currentBookStat,\r\n                    currentSentenceIndex,\r\n                })\r\n            );\r\n            return currentSentenceIndex;\r\n        },\r\n        []\r\n    );\r\n\r\n    return (\r\n        <Provider\r\n            value={{\r\n                getBookStats,\r\n                setBookCurrentWordIndex,\r\n                updateBookCurrentWordIndex,\r\n                setBookSentenceWordIndex,\r\n                updateBookSentenceWordIndex,\r\n            }}\r\n        >\r\n            {children}\r\n        </Provider>\r\n    );\r\n};\r\n\r\nexport { useReadingStatsContext };\r\n\r\nexport default ReadingStatsProvider;\r\n","import { BrowserRouter as Router } from 'react-router-dom';\r\nimport SettingsProvider from './Settings';\r\nimport StorageProvider from './Library';\r\nimport ReadingStatsProvider from './ReadingStats';\r\n\r\ninterface IProvidersProps {\r\n    children: React.ReactNode;\r\n}\r\n\r\nconst Providers = ({ children }: IProvidersProps) => {\r\n    return (\r\n        <Router>\r\n            <SettingsProvider>\r\n                <ReadingStatsProvider>\r\n                    <StorageProvider>{children}</StorageProvider>\r\n                </ReadingStatsProvider>\r\n            </SettingsProvider>\r\n        </Router>\r\n    );\r\n};\r\n\r\nexport default Providers;\r\n","import { useCallback } from \"react\";\r\n\r\nconst canvasCtx = document.createElement(\"canvas\").getContext(\"2d\");\r\n\r\nfunction useTextMeasurer() {\r\n\r\n    const measure = useCallback((fontFamily: string, fontSize: number, text: string) => {\r\n        \r\n        canvasCtx!.font = `${fontSize}px ${fontFamily}`;\r\n        const textMetrics = canvasCtx!.measureText(text);\r\n        const width = Math.abs(textMetrics.actualBoundingBoxLeft) + Math.abs(textMetrics.actualBoundingBoxRight);\r\n        return width;\r\n    }, []);\r\n\r\n    return measure;\r\n\r\n}\r\n\r\nexport default useTextMeasurer;","import { useCallback, useEffect, useMemo, useState } from 'react';\r\nimport cn from 'classnames';\r\n\r\nimport { VariableSizeList as List } from 'react-window';\r\nimport AutoSizer from 'react-virtualized-auto-sizer';\r\n\r\nimport styles from './styles.module.scss';\r\nimport useTextMeasurer from '../../hooks/useTextMeasurer';\r\n\r\ninterface IBookPlayerProps {\r\n    fontFamily?: string;\r\n    fontSize?: number;\r\n    sentences: string[];\r\n    currentIndex: number;\r\n\r\n    onSentenceClick: (index: number) => void;\r\n}\r\n\r\nfunction measureFontHeight(fontName: string, fontSize: number) {\r\n    // get the CSS metrics.\r\n    // NB: NO CSS lineHeight value !\r\n    let div = document.createElement('DIV');\r\n    div.id = '__textMeasure';\r\n    div.innerHTML = 'abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ ';\r\n    div.style.position = 'absolute';\r\n    div.style.top = '-500px';\r\n    div.style.left = '0';\r\n    div.style.fontFamily = fontName;\r\n    div.style.fontSize = fontSize + 'px';\r\n    document.body.appendChild(div);\r\n\r\n    const height = div.offsetHeight;\r\n\r\n    document.body.removeChild(div);\r\n\r\n    return height;\r\n}\r\n\r\nconst SentenceRow = ({ style, data, index }: any) => {\r\n    return (\r\n        <div\r\n            className={cn(styles.sentenceRow, {\r\n                [styles.selected]: index === data.currentIndex,\r\n            })}\r\n            onClick={() => data.onSentenceClick(index)}\r\n            style={style}\r\n        >\r\n            {data.sentences[index]}\r\n        </div>\r\n    );\r\n};\r\n\r\nfunction useTester() {\r\n    const el = document.createElement('div');\r\n    el.style.fontFamily = 'Kazemir';\r\n    el.style.fontSize = '16px';\r\n    el.style.display = 'block';\r\n    el.innerText =\r\n        'Today he was particularly nervous and worried because something had gone seriously wrong with his job,  which was to see that Arthur Dent’s house got cleared out of the  way before the day was out';\r\n    // console.dir(window.getComputedStyle(el))\r\n}\r\n\r\nconst VirtualBookPlayer = ({\r\n    fontFamily = 'Kazemir',\r\n    fontSize = 16,\r\n    sentences,\r\n    currentIndex,\r\n    onSentenceClick,\r\n}: IBookPlayerProps) => {\r\n    // TODO: Add chapter titles\r\n    const [lineHeight, setLineHeight] = useState(fontSize);\r\n    useEffect(() => {\r\n        setLineHeight(measureFontHeight(fontFamily, fontSize));\r\n    }, [fontFamily, fontSize]);\r\n\r\n    useTester();\r\n\r\n    const measureText = useTextMeasurer();\r\n    const getItemSize = useCallback(\r\n        (width: number, index: number) => {\r\n            // TODO: Not accurate\r\n            if (index === 2) {\r\n                console.log(\r\n                    Math.ceil(\r\n                        measureText(fontFamily, fontSize, sentences[index])\r\n                    ) / width\r\n                );\r\n            }\r\n            const itemHeight = Math.ceil(\r\n                (Math.ceil(\r\n                    measureText(fontFamily, fontSize, sentences[index]) / width\r\n                ) +\r\n                    1) *\r\n                    lineHeight\r\n            );\r\n            return itemHeight;\r\n        },\r\n        [sentences, fontSize, fontFamily, measureText]\r\n    );\r\n\r\n    const itemData = useMemo(\r\n        () => ({\r\n            sentences,\r\n            currentIndex,\r\n            onSentenceClick,\r\n        }),\r\n        [sentences, currentIndex, onSentenceClick]\r\n    );\r\n\r\n    return (\r\n        <div\r\n            className={styles.container}\r\n            style={{\r\n                fontFamily: fontFamily,\r\n                fontSize: `${fontSize}px`,\r\n            }}\r\n        >\r\n            <div className={styles.b}>\r\n                <AutoSizer onResize={() => console.log('resize')}>\r\n                    {({ height, width }) => (\r\n                        <List\r\n                            height={height}\r\n                            width={width}\r\n                            itemData={itemData}\r\n                            estimatedItemSize={fontSize * 1.4}\r\n                            itemSize={getItemSize.bind(null, width)}\r\n                            itemCount={sentences.length}\r\n                            className={styles.list}\r\n                            overscanCount={20}\r\n                            // initialScrollOffset={-500}\r\n                        >\r\n                            {SentenceRow}\r\n                        </List>\r\n                    )}\r\n                </AutoSizer>\r\n            </div>\r\n        </div>\r\n    );\r\n};\r\n\r\nexport default VirtualBookPlayer;\r\n","\r\nimport './styles.scss';\r\n\r\ninterface ISingleWordRender {\r\n    word: string;\r\n}\r\n\r\nfunction ORP(word: string){\r\n    var length = word.length;\r\n    while('\\n,.?!:;\"'.indexOf(word[--length]) !== -1);\r\n    switch(++length) {\r\n      case 0: case 1: return 0;\r\n      case 2: case 3: return 1;\r\n      default: return Math.floor(length / 2) - 1;\r\n    }\r\n}\r\n\r\nconst SingleWordRender = ({ word }: ISingleWordRender) => {\r\n\r\n    const split = ORP(word);\r\n    const length = word.length;\r\n    let lpad = '';\r\n    let rpad = '';\r\n\r\n    if (length === 2) {\r\n        rpad = \"\\u00A0\";\r\n    } else if (length === 1 || length === 3) {\r\n    } else if (length % 2) {\r\n        lpad = \"\".padStart(Math.floor(length / 2) - split + 1, \"\\u00A0\");\r\n    } else {\r\n        lpad = \"\".padStart(Math.floor(length / 2) - split, \"\\u00A0\");\r\n    }\r\n\r\n    return (\r\n        <div className=\"word\">\r\n            {lpad + word.substr(0, split)}\r\n            <span className=\"selected\">{word.substr(split, 1)}</span>\r\n            {word.substr(split + 1) + rpad}\r\n        </div>\r\n    );\r\n};\r\n\r\nexport default SingleWordRender;\r\n\r\n","import { useCallback } from 'react';\r\nimport cn from 'classnames';\r\nimport SingleWordRender from '../SingleWordRender';\r\nimport styles from './styles.module.scss';\r\n\r\ninterface IBookPlayerProps {\r\n    isPlaying: boolean;\r\n    bookText: string[];\r\n    currentWordIndex: number;\r\n    onPlayerClick: () => void;\r\n}\r\n\r\nconst clamp = (min: number, val: number, max: number) =>\r\n    Math.max(min, Math.min(val, max));\r\n\r\nconst BookPart = ({\r\n    bookText,\r\n    currentWordIndex,\r\n}: {\r\n    bookText: string[];\r\n    currentWordIndex: number;\r\n}) => {\r\n    const startIndex = Math.max(0, currentWordIndex - 100);\r\n    const stopIndex = Math.min(currentWordIndex + 100, bookText.length);\r\n\r\n    const leftPart = bookText.slice(startIndex, currentWordIndex - 1).join(' ');\r\n    const rightPart = bookText.slice(currentWordIndex + 1, stopIndex).join(' ');\r\n\r\n    return (\r\n        <div className={styles.text}>\r\n            {leftPart}\r\n            <span className={styles.selected}>\r\n                {' '}\r\n                {bookText[currentWordIndex]}{' '}\r\n            </span>\r\n            {rightPart}\r\n        </div>\r\n    );\r\n};\r\n\r\nconst BookPlayer = ({\r\n    isPlaying,\r\n    bookText,\r\n    currentWordIndex,\r\n    onPlayerClick,\r\n}: IBookPlayerProps) => {\r\n    const onClickHandler = useCallback(() => {\r\n        if (isPlaying) {\r\n            onPlayerClick();\r\n        }\r\n    }, [isPlaying, onPlayerClick]);\r\n\r\n    return (\r\n        <div className={styles.container} onClick={onClickHandler}>\r\n            <div\r\n                className={cn(styles.textPlayer, {\r\n                    [styles.playing]: isPlaying,\r\n                })}\r\n            >\r\n                <SingleWordRender word={bookText[currentWordIndex]} />\r\n            </div>\r\n        </div>\r\n    );\r\n};\r\n\r\nexport default BookPlayer;\r\n","function _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\nimport * as React from \"react\";\n\nvar _ref2 = /*#__PURE__*/React.createElement(\"path\", {\n  fill: \"currentColor\",\n  d: \"M416 208H32c-17.67 0-32 14.33-32 32v32c0 17.67 14.33 32 32 32h384c17.67 0 32-14.33 32-32v-32c0-17.67-14.33-32-32-32z\"\n});\n\nfunction SvgMinusSolid(_ref, svgRef) {\n  var title = _ref.title,\n      titleId = _ref.titleId,\n      props = _objectWithoutProperties(_ref, [\"title\", \"titleId\"]);\n\n  return /*#__PURE__*/React.createElement(\"svg\", _extends({\n    \"aria-hidden\": \"true\",\n    focusable: \"false\",\n    \"data-prefix\": \"fas\",\n    \"data-icon\": \"minus\",\n    className: \"svg-inline--fa fa-minus fa-w-14\",\n    role: \"img\",\n    xmlns: \"http://www.w3.org/2000/svg\",\n    viewBox: \"0 0 448 512\",\n    ref: svgRef,\n    \"aria-labelledby\": titleId\n  }, props), title ? /*#__PURE__*/React.createElement(\"title\", {\n    id: titleId\n  }, title) : null, _ref2);\n}\n\nvar ForwardRef = /*#__PURE__*/React.forwardRef(SvgMinusSolid);\nexport default __webpack_public_path__ + \"static/media/minus-solid.4d0790fe.svg\";\nexport { ForwardRef as ReactComponent };","function _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\nimport * as React from \"react\";\n\nvar _ref2 = /*#__PURE__*/React.createElement(\"path\", {\n  fill: \"currentColor\",\n  d: \"M416 208H272V64c0-17.67-14.33-32-32-32h-32c-17.67 0-32 14.33-32 32v144H32c-17.67 0-32 14.33-32 32v32c0 17.67 14.33 32 32 32h144v144c0 17.67 14.33 32 32 32h32c17.67 0 32-14.33 32-32V304h144c17.67 0 32-14.33 32-32v-32c0-17.67-14.33-32-32-32z\"\n});\n\nfunction SvgPlusSolid(_ref, svgRef) {\n  var title = _ref.title,\n      titleId = _ref.titleId,\n      props = _objectWithoutProperties(_ref, [\"title\", \"titleId\"]);\n\n  return /*#__PURE__*/React.createElement(\"svg\", _extends({\n    \"aria-hidden\": \"true\",\n    focusable: \"false\",\n    \"data-prefix\": \"fas\",\n    \"data-icon\": \"plus\",\n    className: \"svg-inline--fa fa-plus fa-w-14\",\n    role: \"img\",\n    xmlns: \"http://www.w3.org/2000/svg\",\n    viewBox: \"0 0 448 512\",\n    ref: svgRef,\n    \"aria-labelledby\": titleId\n  }, props), title ? /*#__PURE__*/React.createElement(\"title\", {\n    id: titleId\n  }, title) : null, _ref2);\n}\n\nvar ForwardRef = /*#__PURE__*/React.forwardRef(SvgPlusSolid);\nexport default __webpack_public_path__ + \"static/media/plus-solid.c82024f4.svg\";\nexport { ForwardRef as ReactComponent };","function secondsToStr(seconds1: number) {\r\n    var temp = seconds1;\r\n    var days = Math.floor((temp %= 31536000) / 86400);\r\n    if (days) {\r\n        return days + ' d';\r\n    }\r\n    var hours = Math.floor((temp %= 86400) / 3600);\r\n    if (hours) {\r\n        return hours + ' h';\r\n    }\r\n    var minutes = Math.floor((temp %= 3600) / 60);\r\n    if (minutes) {\r\n        return minutes + ' m';\r\n    }\r\n    var seconds = temp % 60;\r\n    if (seconds) {\r\n        return seconds + ' s';\r\n    }\r\n    return ''; //'just now' //or other string you like;\r\n}\r\n\r\nexport function completionRate(wordCount: number, currentWordIndex: number) {\r\n    return ((currentWordIndex / wordCount) * 100).toFixed(1);\r\n}\r\n\r\nexport function timeToRead(\r\n    wordCount: number,\r\n    currentWordIndex: number,\r\n    wordPerMinute: number\r\n) {\r\n    return secondsToStr(\r\n        Math.floor((wordCount - currentWordIndex) / (wordPerMinute / 60))\r\n    );\r\n}\r\n","import { ReactComponent as PlayIcon } from '../../assets/icons/play-solid.svg';\r\nimport { ReactComponent as PauseIcon } from '../../assets/icons/pause-solid.svg';\r\nimport { ReactComponent as MinusIcon } from '../../assets/icons/minus-solid.svg';\r\nimport { ReactComponent as PlusIcon } from '../../assets/icons/plus-solid.svg';\r\n\r\nimport styles from './styles.module.scss';\r\nimport { completionRate, timeToRead } from '../../utils/wordTime';\r\nimport { useCallback } from 'react';\r\n\r\ninterface IReaderControlsProps {\r\n    isPlaying: boolean;\r\n\r\n    speedDown: () => void;\r\n    speedUp: () => void;\r\n    togglePlay: () => void;\r\n\r\n    wordsCount: number;\r\n    currentIndex: number;\r\n    wordsPerMinute: number;\r\n}\r\n\r\nconst ReaderControls = ({\r\n    isPlaying,\r\n\r\n    speedDown,\r\n    speedUp,\r\n    togglePlay,\r\n\r\n    wordsCount,\r\n    currentIndex,\r\n    wordsPerMinute,\r\n}: IReaderControlsProps) => {\r\n    const completed = completionRate(wordsCount, currentIndex);\r\n    const ttr = timeToRead(wordsCount, currentIndex, wordsPerMinute);\r\n\r\n    const speedDownHanlder = useCallback((e: React.MouseEvent) => {\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n        speedDown();\r\n    }, [speedDown]);\r\n\r\n    const speedUpHanlder = useCallback((e: React.MouseEvent) => {\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n        speedUp();\r\n    }, [speedUp]);\r\n\r\n    if(isPlaying) {\r\n        return null;\r\n    }\r\n\r\n    return (\r\n        <div className={styles.container} onClick={togglePlay}>\r\n            <div className={styles.topLine} />\r\n            <div className={styles.controls}>\r\n                <MinusIcon className={styles.button} onClick={speedDownHanlder} />\r\n                <div className={styles.wordsPerMinute}>{wordsPerMinute} <br /> word/m</div>\r\n                <PlusIcon className={styles.button} onClick={speedUpHanlder} />\r\n            </div>\r\n            <div className={styles.stats}>\r\n                <div className={styles.bar} style={{ '--total': `${completed}%` } as any} />\r\n                <div className={styles.bottom}>\r\n                    <div>{ttr}</div>\r\n                    <div>{completed}%</div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n};\r\n\r\nexport default ReaderControls;\r\n","function _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\nimport * as React from \"react\";\n\nvar _ref2 = /*#__PURE__*/React.createElement(\"path\", {\n  fill: \"currentColor\",\n  d: \"M487.4 315.7l-42.6-24.6c4.3-23.2 4.3-47 0-70.2l42.6-24.6c4.9-2.8 7.1-8.6 5.5-14-11.1-35.6-30-67.8-54.7-94.6-3.8-4.1-10-5.1-14.8-2.3L380.8 110c-17.9-15.4-38.5-27.3-60.8-35.1V25.8c0-5.6-3.9-10.5-9.4-11.7-36.7-8.2-74.3-7.8-109.2 0-5.5 1.2-9.4 6.1-9.4 11.7V75c-22.2 7.9-42.8 19.8-60.8 35.1L88.7 85.5c-4.9-2.8-11-1.9-14.8 2.3-24.7 26.7-43.6 58.9-54.7 94.6-1.7 5.4.6 11.2 5.5 14L67.3 221c-4.3 23.2-4.3 47 0 70.2l-42.6 24.6c-4.9 2.8-7.1 8.6-5.5 14 11.1 35.6 30 67.8 54.7 94.6 3.8 4.1 10 5.1 14.8 2.3l42.6-24.6c17.9 15.4 38.5 27.3 60.8 35.1v49.2c0 5.6 3.9 10.5 9.4 11.7 36.7 8.2 74.3 7.8 109.2 0 5.5-1.2 9.4-6.1 9.4-11.7v-49.2c22.2-7.9 42.8-19.8 60.8-35.1l42.6 24.6c4.9 2.8 11 1.9 14.8-2.3 24.7-26.7 43.6-58.9 54.7-94.6 1.5-5.5-.7-11.3-5.6-14.1zM256 336c-44.1 0-80-35.9-80-80s35.9-80 80-80 80 35.9 80 80-35.9 80-80 80z\"\n});\n\nfunction SvgCogSolid(_ref, svgRef) {\n  var title = _ref.title,\n      titleId = _ref.titleId,\n      props = _objectWithoutProperties(_ref, [\"title\", \"titleId\"]);\n\n  return /*#__PURE__*/React.createElement(\"svg\", _extends({\n    \"aria-hidden\": \"true\",\n    focusable: \"false\",\n    \"data-prefix\": \"fas\",\n    \"data-icon\": \"cog\",\n    className: \"svg-inline--fa fa-cog fa-w-16\",\n    role: \"img\",\n    xmlns: \"http://www.w3.org/2000/svg\",\n    viewBox: \"0 0 512 512\",\n    ref: svgRef,\n    \"aria-labelledby\": titleId\n  }, props), title ? /*#__PURE__*/React.createElement(\"title\", {\n    id: titleId\n  }, title) : null, _ref2);\n}\n\nvar ForwardRef = /*#__PURE__*/React.forwardRef(SvgCogSolid);\nexport default __webpack_public_path__ + \"static/media/cog-solid.540ab5dc.svg\";\nexport { ForwardRef as ReactComponent };","function _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\nimport * as React from \"react\";\n\nvar _ref2 = /*#__PURE__*/React.createElement(\"path\", {\n  fill: \"currentColor\",\n  d: \"M31.7 239l136-136c9.4-9.4 24.6-9.4 33.9 0l22.6 22.6c9.4 9.4 9.4 24.6 0 33.9L127.9 256l96.4 96.4c9.4 9.4 9.4 24.6 0 33.9L201.7 409c-9.4 9.4-24.6 9.4-33.9 0l-136-136c-9.5-9.4-9.5-24.6-.1-34z\"\n});\n\nfunction SvgAngleLeftSolid(_ref, svgRef) {\n  var title = _ref.title,\n      titleId = _ref.titleId,\n      props = _objectWithoutProperties(_ref, [\"title\", \"titleId\"]);\n\n  return /*#__PURE__*/React.createElement(\"svg\", _extends({\n    \"aria-hidden\": \"true\",\n    focusable: \"false\",\n    \"data-prefix\": \"fas\",\n    \"data-icon\": \"angle-left\",\n    className: \"svg-inline--fa fa-angle-left fa-w-8\",\n    role: \"img\",\n    xmlns: \"http://www.w3.org/2000/svg\",\n    viewBox: \"0 0 256 512\",\n    ref: svgRef,\n    \"aria-labelledby\": titleId\n  }, props), title ? /*#__PURE__*/React.createElement(\"title\", {\n    id: titleId\n  }, title) : null, _ref2);\n}\n\nvar ForwardRef = /*#__PURE__*/React.forwardRef(SvgAngleLeftSolid);\nexport default __webpack_public_path__ + \"static/media/angle-left-solid.e6b3ab3d.svg\";\nexport { ForwardRef as ReactComponent };","\r\nimport { useHistory } from 'react-router-dom';\r\nimport { useCallback } from 'react';\r\n\r\nimport { ReactComponent as CogIcon } from '../../../assets/icons/cog-solid.svg';\r\nimport { ReactComponent as AngleLeft } from '../../../assets/icons/angle-left-solid.svg';\r\n\r\nimport styles from './styles.module.scss';\r\n\r\ninterface IReaderHeaderProps {\r\n    isPlaying: boolean;\r\n    title: string;\r\n}\r\n\r\nconst ReaderHeader = ({\r\n    isPlaying,\r\n    title,\r\n}: IReaderHeaderProps) => {\r\n    const history = useHistory();\r\n    const goBack = useCallback(() => history.goBack(), [history]);\r\n    return (\r\n        <div className={styles.container}>\r\n            <AngleLeft onClick={goBack} />\r\n            <div className={styles.title}>{title}</div>\r\n            <CogIcon />\r\n        </div>\r\n    );\r\n}\r\n\r\nexport default ReaderHeader;","import { useCallback, useEffect, useState } from 'react';\r\nimport { useParams } from 'react-router-dom';\r\nimport { IBookInfo, useLibraryContext } from '../../Providers/Library';\r\n\r\nimport styles from './styles.module.scss';\r\nimport VirtualBookPlayer from '../../Components/VirtualBookPlayer';\r\nimport BookPlayer from '../../Components/BookPlayer';\r\nimport ReaderControls from '../../Components/ReaderControls';\r\nimport ReaderHeader from './ReaderHeader';\r\nimport { useSettingsContext } from '../../Providers/Settings';\r\nimport {\r\n    IBookStat,\r\n    useReadingStatsContext,\r\n} from '../../Providers/ReadingStats';\r\n\r\ninterface TimerOptions {\r\n    delay: number;\r\n    callback: () => void | number;\r\n}\r\n\r\n/** Milliseconds representing forever in the future. */\r\nconst never = Number.MAX_SAFE_INTEGER;\r\n\r\nfunction useAccurateTimer(options: TimerOptions) {\r\n    const now = new Date().getTime();\r\n    const [started, setStarted] = useState(false);\r\n    // This is used to trigger a render that checks to fire the timer\r\n    const [, setCheckTime] = useState(now);\r\n    const [nextFireTime, setNextFireTime] = useState(never);\r\n\r\n    const isStarted = useCallback(() => started, [started]);\r\n    const isStopped = useCallback(() => !isStarted(), [isStarted]);\r\n\r\n    const start = useCallback(() => {\r\n        const currentTime = new Date().getTime();\r\n        const newNextFireTime = options.delay\r\n            ? Math.max(currentTime, currentTime)\r\n            : never;\r\n        setNextFireTime(newNextFireTime);\r\n        setStarted(true);\r\n    }, [options.delay]);\r\n\r\n    const stop = useCallback(() => {\r\n        setNextFireTime(never);\r\n        setStarted(false);\r\n    }, []);\r\n\r\n    useEffect(() => {\r\n        let timeout: NodeJS.Timeout;\r\n\r\n        // If it's a timer and it isn't paused...\r\n        if (options.delay && !isStopped()) {\r\n            // Check if we're overdue on any events being fired (super low delay or expensive callback)\r\n            const overdueCalls = Math.max(\r\n                0,\r\n                Math.floor((now - nextFireTime) / options.delay)\r\n            );\r\n            // If we're overdue, this means we're not firing callbacks fast enough and need to prevent\r\n            // exceeding the maximum update depth.\r\n            // To do this, we only fire the callback on an even number of overdues (including 0, no overdues).\r\n            // Else, we wait a little, then try again.\r\n            if (overdueCalls % 2 !== 1) {\r\n                // If the timer is up...\r\n                if (now >= nextFireTime) {\r\n                    let userDelay = 0;\r\n                    // Call the callback\r\n                    if (typeof options.callback === 'function') {\r\n                        try {\r\n                            userDelay = options.callback() || 0;\r\n                        } catch (e) {\r\n                            console.error(e);\r\n                        }\r\n                    }\r\n                    // Calculate and set the next time the timer should fire\r\n                    const overdueElapsedTime = overdueCalls * options.delay;\r\n                    const newFireTime = Math.max(\r\n                        now,\r\n                        nextFireTime +\r\n                            options.delay +\r\n                            overdueElapsedTime +\r\n                            userDelay\r\n                    );\r\n                    setNextFireTime(newFireTime);\r\n                    // Set a timeout to check and fire the timer when time's up\r\n                    timeout = setTimeout(() => {\r\n                        // This merely triggers a rerender to check if the timer can fire.\r\n                        setCheckTime(new Date().getTime());\r\n                    }, Math.max(newFireTime - new Date().getTime(), 1));\r\n                }\r\n                // Time is not up yet. Set a timeout to check and fire when time's up\r\n                else if (nextFireTime < never) {\r\n                    timeout = setTimeout(() => {\r\n                        // This merely triggers a rerender to check if the timer can fire.\r\n                        setCheckTime(new Date().getTime());\r\n                        // Home in on the exact time to fire.\r\n                    }, Math.max(nextFireTime - new Date().getTime(), 1));\r\n                }\r\n            } else {\r\n                // Relief valve to avoid maximum update depth exceeded errors.\r\n                // When calls become overdue, there's too expensive of a callback or too low of a delay to keep up.\r\n                // In both cases, the React max update stack will be exceeded due to repeated firings.\r\n                // To relieve this, don't check to fire this time around, but check again in a short time.\r\n                timeout = setTimeout(() => {\r\n                    setCheckTime(new Date().getTime());\r\n                }, 20);\r\n            }\r\n        }\r\n\r\n        return () => {\r\n            clearTimeout(timeout);\r\n        };\r\n    }, [now, nextFireTime, isStopped, options.delay, options]);\r\n\r\n    return {\r\n        start,\r\n        stop,\r\n    };\r\n}\r\n\r\nconst Reader = () => {\r\n    const { id } = useParams<{ id: string }>();\r\n\r\n    const { getBook } = useLibraryContext();\r\n    const {\r\n        getBookStats,\r\n        updateBookCurrentWordIndex,\r\n        setBookSentenceWordIndex,\r\n        setBookCurrentWordIndex,\r\n    } = useReadingStatsContext();\r\n    const { settings, updateWordsPerMinute } = useSettingsContext();\r\n\r\n    const [bookInfo, setBookInfo] = useState<IBookInfo>();\r\n    const [bookItems, setBookItems] = useState<string[]>([]);\r\n    const [bookText, setBookText] = useState<string[]>([]);\r\n    const [{ currentWordIndex, currentSentenceIndex }, setBookStat] =\r\n        useState<IBookStat>({ currentWordIndex: 0, currentSentenceIndex: 0 });\r\n\r\n    useEffect(() => {\r\n        getBook(id).then(({ info, items }) => {\r\n            setBookStat(getBookStats(id));\r\n            setBookInfo(info);\r\n            setBookItems(items);\r\n            setBookText(items.join(' ').split(' '));\r\n        });\r\n    }, [id]);\r\n\r\n    const [isPlaying, setPlaying] = useState(false);\r\n\r\n    const { start, stop } = useAccurateTimer({\r\n        delay: (60 / settings.wordsPerMinute) * 1000,\r\n        callback: () => {\r\n            const newWordIndex = updateBookCurrentWordIndex(id, 1);\r\n            setBookStat((prev) => ({\r\n                ...prev,\r\n                currentWordIndex: newWordIndex,\r\n            }));\r\n            return Math.max(0, bookText[newWordIndex].length - 10) * 20;\r\n        },\r\n    });\r\n\r\n    const togglePlay = useCallback(\r\n        () =>\r\n            setPlaying((v) => {\r\n                let newValue = !v;\r\n                if (newValue) {\r\n                    start();\r\n                } else {\r\n                    stop();\r\n                }\r\n                return newValue;\r\n            }),\r\n        [start, stop]\r\n    );\r\n\r\n    const speedUp = useCallback(\r\n        () => updateWordsPerMinute(20),\r\n        [updateWordsPerMinute]\r\n    );\r\n    const speedDown = useCallback(\r\n        () => updateWordsPerMinute(-20),\r\n        [updateWordsPerMinute]\r\n    );\r\n\r\n    const onPlayerClick = useCallback(() => {\r\n        togglePlay();\r\n    }, [togglePlay]);\r\n\r\n    const onSentenceClick = useCallback(\r\n        (index: number) => {\r\n            const newWordIndex =\r\n                bookItems.slice(0, index).join(' ').split(' ').length - 1;\r\n            setBookStat((prev) => ({\r\n                ...prev,\r\n                currentSentenceIndex: index,\r\n                currentWordIndex: newWordIndex,\r\n            }));\r\n            setBookSentenceWordIndex(id, index);\r\n            setBookCurrentWordIndex(id, newWordIndex);\r\n        },\r\n        [setBookSentenceWordIndex, bookItems, id]\r\n    );\r\n\r\n    return (\r\n        <div className={styles.container}>\r\n            <ReaderHeader isPlaying={isPlaying} title={bookInfo?.title || ''} />\r\n            {!isPlaying && (\r\n                <VirtualBookPlayer\r\n                    sentences={bookItems}\r\n                    currentIndex={currentSentenceIndex}\r\n                    onSentenceClick={onSentenceClick}\r\n                />\r\n            )}\r\n            {isPlaying && (\r\n                <BookPlayer\r\n                    isPlaying={isPlaying}\r\n                    bookText={bookText}\r\n                    currentWordIndex={currentWordIndex}\r\n                    onPlayerClick={onPlayerClick}\r\n                />\r\n            )}\r\n            <ReaderControls\r\n                isPlaying={isPlaying}\r\n                currentIndex={currentWordIndex}\r\n                speedDown={speedDown}\r\n                speedUp={speedUp}\r\n                togglePlay={togglePlay}\r\n                wordsCount={bookItems.length}\r\n                wordsPerMinute={settings.wordsPerMinute}\r\n            />\r\n        </div>\r\n    );\r\n};\r\n\r\nexport default Reader;\r\n","import cn from 'classnames';\r\nimport { Link } from 'react-router-dom';\r\nimport { timeToRead, completionRate } from '../../utils/wordTime';\r\nimport styles from './styles.module.scss';\r\n\r\nimport { IBookInfo } from '../../Providers/Library';\r\nimport { useRef } from 'react';\r\n\r\ninterface IBookProps {\r\n    book: IBookInfo;\r\n    stats: {\r\n        completed: string;\r\n        timeToRead: string;\r\n    };\r\n    onClick: (id: string) => void;\r\n}\r\n\r\nfunction Book({ book, stats, onClick }: IBookProps) {\r\n\r\n    const wrapperRef = useRef<HTMLDivElement>(null);\r\n\r\n    const completed = completionRate(1500, 1000);\r\n    const ttr = timeToRead(1500, 1000, 320);\r\n    console.log(book)\r\n    return (\r\n        <Link to={`/book/${book.id}`} className={styles.container}>\r\n            <div\r\n                className={cn(styles.book, styles.nocover, {\r\n                    [styles.nocover]: !book.cover,\r\n                    [styles.nocover]: book.cover,\r\n                })}\r\n                // style={\r\n                //     book.cover\r\n                //         ? ({ '--cover': `url(${book.cover})` } as any)\r\n                //         : {}\r\n                // }\r\n            >\r\n                {(book.cover || !book.cover) && (\r\n                    <div ref={wrapperRef} className={styles.bookWrapper}>\r\n                        <svg >\r\n                            <foreignObject x=\"0\" y=\"0\" width=\"100%\" height=\"100%\">\r\n                                <div className={styles.title}>{book.title}</div>\r\n                            </foreignObject>\r\n                        </svg>\r\n                        <svg >\r\n                            <foreignObject x=\"0\" y=\"50%\" width=\"100%\" height=\"100%\">\r\n                                <div className={styles.author}>{book.creator}</div>\r\n                            </foreignObject>\r\n                        </svg>\r\n                    </div>\r\n                )}\r\n            </div>\r\n            <div className={styles.bottom}>\r\n                <div>\r\n                    {stats.completed !== '100'\r\n                        ? `${stats.completed} %`\r\n                        : 'FINISHED'}\r\n                </div>\r\n                <div>{stats.timeToRead}</div>\r\n            </div>\r\n        </Link>\r\n    );\r\n}\r\n\r\nexport default Book;\r\n","import { useCallback } from 'react';\r\n\r\nfunction useFileInput(options: any, callback: (files: File[]) => void) {\r\n    const onAction = useCallback(() => {\r\n        const input = document.createElement('input');\r\n        input.type = 'file';\r\n        input.multiple = true;\r\n        input.onchange = (event) => {\r\n            if (!event.target || (event.target as any).files.length === 0) {\r\n                return callback([]);\r\n            }\r\n            callback((event.target as any).files);\r\n        };\r\n        input.click();\r\n    }, [callback]);\r\n\r\n    return onAction;\r\n}\r\n\r\nexport default useFileInput;\r\n","import Book from '../../Components/Book';\r\nimport styles from './styles.module.scss';\r\n\r\nimport { useLibraryContext } from '../../Providers/Library';\r\nimport { useReadingStatsContext } from '../../Providers/ReadingStats';\r\n\r\nimport useFileInput from '../../hooks/useFileInput';\r\nimport { useCallback } from 'react';\r\n\r\nimport { ReactComponent as PlusIcon } from '../../assets/icons/plus-solid.svg';\r\n\r\nconst Library = () => {\r\n    const { library, loadBooks } = useLibraryContext();\r\n    const { getBookStats } = useReadingStatsContext();\r\n\r\n    const onAdd = useFileInput({ multiple: true }, async (files: File[]) => {\r\n        if (files.length === 0) {\r\n            return;\r\n        }\r\n        await loadBooks(files);\r\n    });\r\n\r\n    const onBookClick = useCallback((id: string) => {}, []);\r\n\r\n    return (\r\n        <div className={styles.container}>\r\n            <div className={styles.header}>\r\n                <div className={styles.title}>Library</div>\r\n                <div className={styles.add} onClick={onAdd}>\r\n                    <PlusIcon />\r\n                </div>\r\n            </div>\r\n            <div className={styles.listContainer}>\r\n                <div className={styles.list}>\r\n                    {library.map((book) => (\r\n                        <Book\r\n                            key={book.id}\r\n                            book={book}\r\n                            stats={{\r\n                                completed: '100',\r\n                                timeToRead: '1',\r\n                            }}\r\n                            onClick={onBookClick}\r\n                        />\r\n                    ))}\r\n                </div>\r\n            </div>\r\n            <div className={styles.bottomMenu}>\r\n                <div>Library</div>\r\n                <div>Settings</div>\r\n            </div>\r\n        </div>\r\n    );\r\n};\r\n\r\nexport default Library;\r\n","\r\nimport { Switch, Route } from 'react-router-dom';\r\nimport Providers from './Providers';\r\n\r\nimport Reader from './Pages/Reader';\r\nimport Library from './Pages/Library';\r\n\r\nimport './App.css';\r\n\r\nfunction App() {\r\n  return (\r\n    <Providers>\r\n      <Switch>\r\n        <Route path=\"/book/:id\" component={Reader} />\r\n        <Route path=\"/\" component={Library} />\r\n      </Switch>\r\n    </Providers>\r\n  );\r\n}\r\n\r\nexport default App;\r\n","import { ReportHandler } from 'web-vitals';\r\n\r\nconst reportWebVitals = (onPerfEntry?: ReportHandler) => {\r\n  if (onPerfEntry && onPerfEntry instanceof Function) {\r\n    import('web-vitals').then(({ getCLS, getFID, getFCP, getLCP, getTTFB }) => {\r\n      getCLS(onPerfEntry);\r\n      getFID(onPerfEntry);\r\n      getFCP(onPerfEntry);\r\n      getLCP(onPerfEntry);\r\n      getTTFB(onPerfEntry);\r\n    });\r\n  }\r\n};\r\n\r\nexport default reportWebVitals;\r\n","import React from 'react';\r\nimport ReactDOM from 'react-dom';\r\nimport './index.css';\r\nimport App from './App';\r\nimport reportWebVitals from './reportWebVitals';\r\n\r\nReactDOM.render(\r\n  <React.StrictMode>\r\n    <App />\r\n  </React.StrictMode>,\r\n  document.getElementById('root')\r\n);\r\n\r\n// If you want to start measuring performance in your app, pass a function\r\n// to log results (for example: reportWebVitals(console.log))\r\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\r\nreportWebVitals();\r\n"],"sourceRoot":""}